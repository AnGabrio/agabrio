<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.3.1">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Andrea Gabrio">

  
  
  
    
  
  <meta name="description" content="This tutorial will focus on the use of Bayesian estimation to fit simple linear regression models. BUGS (Bayesian inference Using Gibbs Sampling) is an algorithm and supporting language (resembling R) dedicated to performing the Gibbs sampling implementation of Markov Chain Monte Carlo (MCMC) method. Dialects of the BUGS language are implemented within three main projects:
OpenBUGS - written in component pascal.
JAGS - (Just Another Gibbs Sampler) - written in C&#43;&#43;.">

  
  <link rel="alternate" hreflang="en-us" href="/jags/gof-tests-jags/gof-tests-jags/">

  


  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin="anonymous">
    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:450,700|Oswald+Sans:600,700|Roboto+Mono:550,700">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.79d76725ea956cf98045e5d9e289f2aa.css">

  
    
    
    
    
      
    
    
    
    <link rel="stylesheet" href="/css/academic.d8c4ad17876b79f73e24a31116b20b9c.css">
  

  
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/jags/gof-tests-jags/gof-tests-jags/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Andrea Gabrio">
  <meta property="og:url" content="/jags/gof-tests-jags/gof-tests-jags/">
  <meta property="og:title" content="Goodness of fit tests - JAGS | Andrea Gabrio">
  <meta property="og:description" content="This tutorial will focus on the use of Bayesian estimation to fit simple linear regression models. BUGS (Bayesian inference Using Gibbs Sampling) is an algorithm and supporting language (resembling R) dedicated to performing the Gibbs sampling implementation of Markov Chain Monte Carlo (MCMC) method. Dialects of the BUGS language are implemented within three main projects:
OpenBUGS - written in component pascal.
JAGS - (Just Another Gibbs Sampler) - written in C&#43;&#43;."><meta property="og:image" content="/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2020-02-12T21:13:14-05:00">
  
  <meta property="article:modified_time" content="2020-02-12T21:13:14-05:00">
  

  


  





  <title>Goodness of fit tests - JAGS | Andrea Gabrio</title>

</head>


<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Andrea Gabrio</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/post/"><span>Blog</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/research/"><span>Research</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/publication/"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/talk/"><span>Talks</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Software</span><span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            
            <li class="dropdown-item my-0 py-0 mx-0 px-0">
              <a href="/missingHE/"><span>missingHE</span></a>
            </li>
            
          </ul>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Tutorials</span><span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            
            <li class="dropdown-item my-0 py-0 mx-0 px-0">
              <a href="/JAGS/"><span>JAGS</span></a>
            </li>
            
            <li class="dropdown-item my-0 py-0 mx-0 px-0">
              <a href="/OpenBUGS/"><span>OpenBUGS</span></a>
            </li>
            
            <li class="dropdown-item my-0 py-0 mx-0 px-0">
              <a href="/STAN/"><span>STAN</span></a>
            </li>
            
          </ul>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/rubric/"><span>Missing Data</span></a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Goodness of fit tests - JAGS</h1>

  

  
    



<meta content="2020-02-12 21:13:14 -0500 -0500" itemprop="datePublished">
<meta content="2020-02-12 21:13:14 -0500 -0500" itemprop="dateModified">

<div class="article-metadata">

  
  
  
  
  <div>
    



  <span itemprop="author name" itemtype="http://schema.org/Person"><a>Andrea Gabrio</a></span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    <time>Feb 12, 2020</time>
  </span>
  

  

  

  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    <a href="/categories/r/">R</a>, <a href="/categories/jags/">JAGS</a>, <a href="/categories/goodness-of-fit-tests/">goodness of fit tests</a>, <a href="/categories/frequency-analysis/">frequency analysis</a></span>
  

  
    

  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      


<p>This tutorial will focus on the use of Bayesian estimation to fit simple linear regression models. <code>BUGS</code> (Bayesian inference Using <em>Gibbs Sampling</em>) is an algorithm and supporting language (resembling <code>R</code>) dedicated to performing the Gibbs sampling implementation of <em>Markov Chain Monte Carlo</em> (MCMC) method. Dialects of the <code>BUGS</code> language are implemented within three main projects:</p>
<ol style="list-style-type: decimal">
<li><p><strong>OpenBUGS</strong> - written in component pascal.</p></li>
<li><p><strong>JAGS</strong> - (Just Another Gibbs Sampler) - written in <code>C++</code>.</p></li>
<li><p><strong>STAN</strong> - a dedicated Bayesian modelling framework written in <code>C++</code> and implementing <em>Hamiltonian</em> MCMC samplers.</p></li>
</ol>
<p>Whilst the above programs can be used stand-alone, they do offer the rich data pre-processing and graphical capabilities of <code>R</code>, and thus, they are best accessed from within <code>R</code> itself. As such there are multiple packages devoted to interfacing with the various software implementations:</p>
<ul>
<li><p><em>R2OpenBUGS</em> - interfaces with <code>OpenBUGS</code></p></li>
<li><p><em>R2jags</em> - interfaces with <code>JAGS</code></p></li>
<li><p><em>rstan</em> - interfaces with <code>STAN</code></p></li>
</ul>
<p>This tutorial will demonstrate how to fit models in <code>JAGS</code> (<span class="citation">Plummer (2004)</span>) using the package <code>R2jags</code> (<span class="citation">Su et al. (2015)</span>) as interface, which also requires to load some other packages.</p>
<div id="overview" class="section level1">
<h1>Overview</h1>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The analyses described in previous tutorials have all involved response variables that implicitly represent normally distributed and continuous population responses. In this context, continuous indicates that (at least in theory), any value of measurement down to an infinite number of decimal places is possible. Population responses can also be categorical such that the values could be logically or experimentally constrained to a set number of discrete possibilities. For example, individuals in a population can be categorized as either male or female, reaches in a stream could be classified as either riffles, runs or pools and salinity levels of sites might be categorized as either high, medium or low. Typically, categorical response variables are tallied up to generate the frequency of replicates in each of the possible categories. From above, we would tally up the frequency of males and females, the number of riffles, runs and pools and the high, medium and low salinity sites. Hence, rather than model data in which a response was measured from each replicate in the sample (as was the case for previous analyses in this series), frequency analyses model data on the frequency of replicates in each possible category. Furthermore, frequency data follow a Poisson distribution rather than a normal distribution. The Poisson distribution is a symmetrical distribution in which only discrete integer values are possible and whose variance is equal to its mean.</p>
<p>Since the mean and variance of a Poisson distribution are equal, distributions with higher expected values are shorter and wider than those with smaller means. Note that a Poisson distribution with an expected less than less than <span class="math inline">\(5\)</span> will be obviously asymmetrical as a Poisson distribution is bounded to the left by zero. This has important implications for the reliability of frequency analyses when sample sizes are low. The frequencies expected for each category are determined by the size of the sample and the nature of the (null) hypothesis. For example, if the null hypothesis is that there are three times as many females as males in a population (ratio of <span class="math inline">\(3:1\)</span>), then a sample of <span class="math inline">\(110\)</span> individuals would be expected to yield <span class="math inline">\(0.75\times110=82.5\)</span> females and <span class="math inline">\(0.25\times110=27.5\)</span> males.</p>
</div>
<div id="the-chi-square-statistic" class="section level2">
<h2>The Chi-square statistic</h2>
<p>The degree of difference between the observed (o) and expected (e) sample category frequencies is represented by the chi-square (<span class="math inline">\(\chi^2\)</span>) statistic.</p>
<p><span class="math display">\[ \chi^2=\sum\frac{(o-e)^2}{e}.\]</span></p>
<p>This is a relative measure that is standardised by the magnitude of the expected frequencies. When the null hypothesis is true (typically this represents the situation when there are no effects or patterns of interest in the population response category frequencies), and we have sampled in an unbiased manner, we might expect the observed category frequencies in the sample to be very similar (if not equal) to the expected frequencies and thus, the chi-square value should be close to zero. Likewise, repeated sampling from such a population is likely to yield chi-square values close to zero and large chi-square values should be relatively rare. As such, the chi-square statistic approximately follows a <span class="math inline">\(\chi^2\)</span> distribution, a mathematical probability distribution representing the frequency (and thus probability) of all possible ranges of chi-square statistics that could result when the null hypothesis is true.<br />
The <span class="math inline">\(\chi^2\)</span> distribution is defined as:</p>
<p><span class="math display">\[ p(x) = \frac{1}{2^{\frac{n}{2}}\gamma(\frac{n}{2})}x^{\frac{n}{2-1}}e^{-\frac{x}{2}}.\]</span></p>
<p>Note that the location AND shape are both determined by a single parameter (the sample size, n which is also equal to the degrees of freedom <span class="math inline">\(+ 1\)</span>). The <span class="math inline">\(\chi^2\)</span> distribution is an asymmetrical distribution bounded by zero and infinity and whose exact shape is determined by the degrees of freedom (calculated as the total number of categories minus <span class="math inline">\(1\)</span>). Note also that the peak of a chi-square distribution is not actually at zero (although it does approach it when the degrees of freedom is equal to zero). Initially, this might seem counter intuitive. We might expect that when a null hypothesis is true, the most common chi-square value will be zero. However, the <span class="math inline">\(\chi^2\)</span> distribution takes into account the expected natural variability in a population as well as the nature of sampling (in which multiple samples should yield slightly different results). The more categories there are, the more likely that the observed and expected values will differ. It could be argued that when there are a large number of categories, samples in which all the observed frequencies are very close to the expected frequencies are a little suspicious and may represent dishonesty on the part of the researcher (Indeed the extraordinary conformity of Gregor Mendelâ€™s pea experiments have been subjected to such skepticism).</p>
<p>By comparing any given sample chi-square statistic to its appropriate <span class="math inline">\(\chi^2\)</span> distribution, the probability that the observed category frequencies could have be collected from a population with a specific ratio of frequencies (for example <span class="math inline">\(3:1\)</span>) can be estimated. As is the case for most hypothesis tests, probabilities lower than <span class="math inline">\(0.05\)</span> (<span class="math inline">\(5\)</span>%) are considered unlikely and suggest that the sample is unlikely to have come from a population characterized by the null hypothesis. Chi-squared tests are typically one-tailed tests focusing on the right-hand tail as we are primarily interested in the probability of obtaining large chi-square values. Nevertheless, it is also possible to focus on the left-hand tail so as to investigate whether the observed values are “too good to be true”.</p>
</div>
<div id="assumptions" class="section level2">
<h2>Assumptions</h2>
<p>A chi-square statistic will follow a <span class="math inline">\(\chi^2\)</span> distribution approximately provided that:</p>
<ul>
<li><p>All observations are classified independently of one another. The classification of one replicate should not be influenced by or related to the classification of other replicates. Random sampling should address this.</p></li>
<li><p>No more than <span class="math inline">\(20\)</span>% of the expected frequencies are less than five. <span class="math inline">\(\chi^2\)</span> distributions do not reliably approximate the distribution of all possible chi-square values under those circumstances (Expected frequencies less than five result in asymmetrical sampling distributions (since they must be truncated at zero) and thus potentially unrepresentative χ2 distributions). Since the expected values are a function of sample sizes, meeting this assumption is a matter of ensuring sufficient replication. When sample sizes or other circumstances beyond control lead to a violation of this assumption, numerous options are available.</p></li>
</ul>
</div>
<div id="goodness-of-fit-tests" class="section level2">
<h2>Goodness of fit tests</h2>
<p><strong>Homogeneous frequencies tests</strong></p>
<p>Homogeneous frequencies tests (often referred to as goodness of fit tests) are used to test null hypotheses that the category frequencies observed within a single variable could arise from a population displaying a specific ratio of frequencies. The null hypothesis (<span class="math inline">\(H_0\)</span>) is that the observed frequencies come from a population with a specific ratio of frequencies.</p>
<p><strong>Distributional conformity - Kolmogorov-Smirnov tests</strong></p>
<p>Strictly, goodness of fit tests are used to examine whether a frequency/sampling distribution is homogeneous with some declared distribution. For example, we might use a goodness of fit test to formally investigate whether the distribution of a response variable deviates substantially from a normal distribution. In this case, frequencies of responses in a set of pre-defined bin ranges are compared to those frequencies expected according to the mathematical model of a normal distribution. Since calculations of these expected frequencies also involve estimates of population mean and variance (both required to determine the mathematical formula), a two degree of freedom loss is incurred (hence <span class="math inline">\(df=n−2\)</span>).</p>
</div>
<div id="contingency-tables" class="section level2">
<h2>Contingency tables</h2>
<p>Contingency tables are used to investigate the associations between two or more categorical variables. That is, they test whether the patterns of frequencies in one categorical variable differ between different levels of other categorical variable(s) or ould the variables be independent of another. In this way, they are analogous to interactions in factorial linear models (such as factorial ANOVA). Contingency tables test the null hypothesis (<span class="math inline">\(H_0\)</span>) that the categorical variables are independent of (not associated with) one another. Note that analyses of contingency tables do not empirically distinguish between response and predictor variables (analogous to correlation), yet causality can be implied when logical and justified by interpretation. As an example, contingency tables could be used to investigate whether incidences of hair and eye color in a population are associated with one another (is one hair color type more commonly observed with a certain eye color). In this case, neither hair color nor eye color influence one another, their incidences are both controlled by a separate set of unmeasured factors. By contrast, an association between the presence or absence of a species of frog and the level of salinity (high, medium or low) could imply that salinity effects the distribution of that species of frog - but not vice versa. Sample replicates are cross-classified according to the levels (categories) of multiple categorical variables. The data are conceptualized as a table (hence the name) with the rows representing the levels of one variable and the column the levels of the other variable(s) such that the cells represent the category combinations. The expected frequency of any given cell is calculated as:</p>
<p><span class="math display">\[ \frac{\text{(row total)} \times \text{(column total)}}{\text{(grand total)}}.\]</span></p>
<p>Thereafter, the chi-square calculations are calculated as described above and the chi-square value is compared to a <span class="math inline">\(\chi^2\)</span> distribution with <span class="math inline">\((r−1)(c−1)\)</span> degrees of freedom. Contingency tables involving more than two variables have multiple interaction levels and thus multiple potential sources of independence. For example, in a three-way contingency table between variables A, B and C, there are four interactions (A:B, A:C, B:C and A:B:C). Such designs are arguably more appropriately analysed using log-linear models.</p>
<p><strong>Odds ratios</strong></p>
<p>The chi-square test provides an indication of whether or not the occurrences in one set of categories are likely to be associated with other sets of categories (an interaction between two or more categorical variables), yet does not provide any indication of how strongly the variables are associated (magnitude of the effect). Furthermore, for variables with more than two categories (e.g. high, medium, low), there is no indication of which category combinations contribute most to the associations. This role is provided by odds ratios which are essentially a measure of effect size. Odds refer the likelihood of a specific event or outcome occurring (such as the odds of a species being present) versus the odds of it not occurring (and thus the occurrence of an alternative outcome) and are calculated as <span class="math inline">\(\frac{\pi_j}{(1-\pi_j)}\)</span> where <span class="math inline">\(\pi_j\)</span> refers to the probability of the event occurring. For example, we could calculate the odds of frogs being present in highly saline habitats as the probability of frogs being present divided by the probability of them being absent. Similarly, we could calculate the likelihood of frog presence (odds) within low salinity habitats. The ratio of two of these likelihoods (odds ratio) can then be used to compare whether the likelihood of one outcome (frog presence) is the same for both categories (salinity levels). For example, is the likelihood of frogs being present in highly saline habitats the same as the probability of them being present in habitats with low levels of salinity. In so doing, the odds ratio is a measure of effect size that describes the strength of an association between pairs of cross-classification levels. Although odds and thus odds ratios (<span class="math inline">\(\theta\)</span>) are technically derived from probabilities, they can also be estimated using cell frequencies (<span class="math inline">\(n\)</span>).</p>
<p><span class="math display">\[ \theta = \frac{n_{11}n_{22}}{n_{12}n_{21}}\]</span></p>
<p>or alternatively</p>
<p><span class="math display">\[ \theta = \frac{(n_{11}+0.5)(n_{22}+0.5)}{(n_{12} + 0.5)(n_{21} + 0.5)}\]</span></p>
<p>where <span class="math inline">\(0.5\)</span> is a small constant added to prevent division by zero. An odds ratio of one indicates that the event or occurrence (presence of frogs) is equally likely in both categories (high and low salinity habitats). Odds ratios greater than one signify that the event or occurrence is more likely in the first than second category and vice verse for odds ratios less than one. For example, when comparing the presence/absence of frogs in low versus high salinity habitats, an odds ratio of <span class="math inline">\(5.8\)</span> would suggest that frogs are <span class="math inline">\(5.8\)</span> times more likely to be present in low salinity habitats than those that highly saline. The distribution of odds ratios (which range from <span class="math inline">\(0\)</span> to <span class="math inline">\(\infty\)</span>) is not symmetrical around the null position (<span class="math inline">\(1\)</span>) thereby precluding confidence interval and standard error calculations. Instead, these measures are calculated from log transformed (natural log) odds ratios (the distribution of which is a standard normal distribution centered around <span class="math inline">\(0\)</span>) and then converted back into a linear scale by anti-logging. Odds ratios can only be calculated between category pairs from two variables and therefore <span class="math inline">\(2 \times 2\)</span> contingency tables (tables with only two rows and two columns). However, tables with more rows and columns can be accommodate by splitting the table up into partial tables of specific category pair combinations. Odds ratios (and confidence intervals) are then calculated from each pairing, notwithstanding their lack of independence. For example, if there were three levels of salinity (high, medium and low), the odds ratios from three partial tables (high vs medium, high vs low, medium vs low) could be calculated.</p>
<p>Since odds ratios only explore pairwise patterns within two-way interactions, odds ratios for multi-way (three or more variables) tables are considerably more complex to calculate and interpret. Partial tables between two of the variables (e.g frog presence/absence and high/low salinity) are constructed for each level of a third (season: summer/winter). This essentially removes the effect of the third variable by holding it constant. Associations in partial tables are therefore referred to as conditional associations - since the outcomes (associated or independent) from each partial table are explicitly conditional on the level of the third variable at which they were tested.</p>
<p>Specific contributions to a lack of independence (significant associations) can also be investigated by exploring the residuals. Recall that residuals are the difference between the observed values (frequencies) and those predicted or expected when the null hypothesis is true (no association between variables). Hence the magnitude of each residual indicates how much each of the cross classification combinations differs from what is expected. The residuals are typically standardized (by dividing by the square of the expected frequencies) to enable individual residuals to be compared relative to one another. Large residuals (in magnitude) indicate large deviations from what is expected when the null hypothesis is true and thus also indicate large influences (contributions) to the overall association. The sign (<span class="math inline">\(+\)</span> or <span class="math inline">\(-\)</span>) of the residual indicates whether the frequencies were higher or lower than expected.</p>
</div>
<div id="g-tests" class="section level2">
<h2>G tests</h2>
<p>An alternative to the chi-square test for goodness of fit and contingency table analyses is the G-test. The G-test is based on a log likelihood-ratio test. A log likelihood ratio is a ratio of maximum likelihoods of the alternative and null hypotheses. More simply, a log likelihood ratio test essentially examines how likely (the probability) the alternative hypothesis (representing an effect) is compared to how likely the null hypothesis (no effect) is given the collected data. The G2 statistic is calculated as:</p>
<p><span class="math display">\[ G^2 = 2 \sum o \; ln\frac{o}{e}\]</span></p>
<p>where o and e are the observed and expected sample category frequencies respectively and ln denotes the natural logarithm (base e). When the null hypothesis is true, the G2 statistic approximately follows a theoretical <span class="math inline">\(\chi^2\)</span> distribution with the same degrees of freedom as the corresponding chi-square statistic. The G2 statistic (which is twice the value of the log-likelihood ratio) is arguably more appropriate than the chi-square statistic as it is closely aligned with the theoretical basis of the χ2 distribution (for which the chi-squared statistic is a convenient approximation). For large sample sizes, G2 and <span class="math inline">\(\chi^2\)</span> statistics are equivalent, however the former is a better approximation of the theoretical chi2 distribution when the difference between the observed and expected is less than the expected frequencies (ie <span class="math inline">\(|o−e|&lt;e\)</span>). Nevertheless, G-tests operate under the same assumptions are the chi-square statistic and thus very small sample sizes (expected values less than <span class="math inline">\(5\)</span>) are still problematic. G-tests have the additional advantage that they can be used additively with more complex designs and a thus more extensible than the chi-squared statistic.</p>
</div>
<div id="small-sample-sizes" class="section level2">
<h2>Small sample sizes</h2>
<p>As discussed previously, both the <span class="math inline">\(\chi^2\)</span> and G2 statistics are poor approximations of theoretical <span class="math inline">\(\chi^2\)</span> distributions when sample sizes are very small. Under these circumstances a number of alternative options are available:</p>
<ul>
<li><p>If the issue has arisen due to a large number of category levels in one or more of the variables, some categories could be combined together.</p></li>
<li><p>Fishers exact test which essentially calculates the probability of obtaining the cell frequencies given the observed marginal totals in <span class="math inline">\(2 \times 2\)</span> tables. The calculations involved in such tests are extremely tedious as they involve calculating probabilities from hypergeometric distributions (discrete distributions describing the number of successes from sequences of samples drawn with out replacement) for all combinations of cell values that result in the given marginal totals.</p></li>
<li><p>Yates’ continuity correction calculates the test statistic after adding and subtracting <span class="math inline">\(0.5\)</span> from observed values less than and greater than expected values respectively. Yates’ correction can only be applied to designs with a single degree of freedom (goodness-of-fit designs with two categories or <span class="math inline">\(2 \times 2\)</span> tables) and for goodness-of-fit tests provide p-values that are closer to those of an exact binomial. However, they typically yield over inflated p-values in contingency tables and so have gone out of favour.</p></li>
<li><p>Williams’ correction is applied by dividing the test statistic by <span class="math inline">\(1+(p2−1)6nv\)</span>, where <span class="math inline">\(p\)</span> is the number of categories, <span class="math inline">\(n\)</span> is the total sample size (total of observed frequencies) and <span class="math inline">\(v\)</span> is the number of degrees of freedom <span class="math inline">\((p−1)\)</span>. Williams’ corrections can be applied to designs with greater than one degree of freedom, and are considered marginally more appropriate than Yates’ corrections if corrections are insisted.</p></li>
<li><p>Randomisation tests in which the sample test statistic (either <span class="math inline">\(\chi^2\)</span> or G2) is compared to a probability distribution generated by repeatedly calculating the test statistic from an equivalent number of observations drawn from a population (sampling with replacement) with the specific ratio of category frequencies defined by the null hypothesis. Significance is thereafter determined by the proportion of the randomised test statistic values that are greater than or equal to the value of the statistic that is based on observed data.</p></li>
<li><p>Log-linear modelling (as a form of generalized linear model)</p></li>
</ul>
</div>
</div>
<div id="data-generation" class="section level1">
<h1>Data generation</h1>
<p>Goodness of fit tests are concerned with comparing the observed frequencies with those expected on the basis of a specific null hypothesis. So lets now fabricate a motivating scenario and some data. We will create a scenario that involves items classified into one of three groups (A, B and C). The number of items in each classification group are then tallied up. Out of a total of <span class="math inline">\(47\)</span> items, <span class="math inline">\(15\)</span> where of type A, <span class="math inline">\(9\)</span> where of type B and <span class="math inline">\(23\)</span> where of type C. We could evaluate a parity (a <span class="math inline">\(1:1:1\)</span> ratio from these data. In a frequentist context, this might involve testing a null hypothesis that the observed data could have come from a population with a <span class="math inline">\(1:1\)</span> item ratio. In this case the probability would be the probability of obtaining the observed ratio of frequencies when the null hypothesis is true. In a Bayesian context, there are numerous ways that we could tackle these data. We would be evaluating the evidence for the null hypothesis (<span class="math inline">\(1:1:1\)</span> item ratio) given the observed by estimating the degree of freedom from a chi-square distribution. Alternatively, we could estimate the value of the three population fractions which are expected to be <span class="math inline">\(1/3, 1/3, 1/3\)</span> when <span class="math inline">\(1:1:1\)</span>. We will explore this option first and then explore the chi-square approach second. To extend the example, lets also explore a <span class="math inline">\(1:1:2\)</span> ratio. We start by generating the observed data:</p>
<pre class="r"><code>&gt; #the observed frequences of A and B
&gt; obs &lt;- c(15,9,23)
&gt; obs
[1] 15  9 23</code></pre>
</div>
<div id="estimating-population-fractions---binomial-distribution" class="section level1">
<h1>Estimating population fractions - binomial distribution</h1>
<p>The binomial distribution represents the distribution of possible densities (probabilities) for the number of successes p out of a total of n independent trials. In this case, it can be used to model the number of items of each group (A, B and C) out of a total of <span class="math inline">\(47\)</span> items. The prior distribution for <span class="math inline">\(p_i\)</span> would be a beta distribution (values range from <span class="math inline">\(0\)</span> to <span class="math inline">\(1\)</span>) with shape parameters a and b the hyperpriors of which follow vague (flat, imprecise) gamma distributions.</p>
<p><span class="math display">\[ obs_i \sim \text{Bin}(p_i,n_i),\]</span></p>
<p>where <span class="math inline">\(p_i\sim \text{Beta}(a,b)\)</span> and <span class="math inline">\(a,b \sim \text{Gamma}(1,0.01)\)</span>.</p>
<div id="exploratory-data-analysis" class="section level2">
<h2>Exploratory data analysis</h2>
<p>The data should logically follow a binomial distribution (since the observations are counts of positive events out of a total).</p>
</div>
<div id="model-fitting" class="section level2">
<h2>Model fitting</h2>
<p>We now translate the likelihood model into <code>JAGS</code> code and store the code in an external file.</p>
<pre class="r"><code>&gt; modelString=&quot;
+ model {
+   #Likelihood
+  for (i in 1:nGroups) {
+    obs[i] ~ dbin(p[i],n[i])
+    p[i] ~ dbeta(a[i],b[i])
+    a[i] ~ dgamma(1,0.01)
+    b[i] ~ dgamma(1,0.01)
+  }
+  }
+ &quot;
&gt; ## write the model to a text file 
&gt; writeLines(modelString,con=&quot;chi2model.txt&quot;)</code></pre>
<ul>
<li><p>The likelihood model indicates that the observed counts are modeled by a binomial distribution with a probability of p (fraction) from n trials (items).</p></li>
<li><p>The prior on each p is defined as a beta distribution with shape parameters a and b</p></li>
<li><p>The hyperpriors for each a and b are drawn from imprecise (vague, flat) gamma distributions.</p></li>
</ul>
<p>Define the data list. This all needs to be contained within a list object. We will create two data lists, one for each of the hypotheses.</p>
<pre class="r"><code>&gt; # The observed item frequencies
&gt; obs &lt;- c(15, 9, 23)
&gt; data.list &lt;- list(obs = obs, n = c(47, 47, 47), nGroups = 3)
&gt; data.list
$obs
[1] 15  9 23

$n
[1] 47 47 47

$nGroups
[1] 3</code></pre>
<p>Define the parameters to monitor and the chain details</p>
<pre class="r"><code>&gt; params &lt;- c(&quot;p&quot;)
&gt; nChains = 2
&gt; burnInSteps = 1000
&gt; thinSteps = 1
&gt; numSavedSteps = 5000
&gt; nIter = ceiling((numSavedSteps * thinSteps)/nChains)</code></pre>
<p>Fit the model in <code>JAGS</code> using the function <code>jags</code> in the package <code>R2jags</code> (which should be loaded first).</p>
<pre class="r"><code>&gt; library(R2jags)
&gt; # Fit the model for the 1:1:1 ratio
&gt; data.r2jags &lt;- jags(data = data.list, inits = NULL, parameters.to.save = params, 
+                     model.file = &quot;chi2model.txt&quot;,n.chains = nChains, n.iter = nIter, 
+                     n.burnin = burnInSteps, n.thin = thinSteps)
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 3
   Unobserved stochastic nodes: 9
   Total graph size: 18

Initializing model
&gt; 
&gt; print(data.r2jags)
Inference for Bugs model at &quot;chi2model.txt&quot;, fit using jags,
 2 chains, each with 2500 iterations (first 1000 discarded)
 n.sims = 3000 iterations saved
         mu.vect sd.vect   2.5%    25%    50%    75%  97.5%  Rhat n.eff
p[1]       0.323   0.064  0.205  0.276  0.321  0.365  0.449 1.003   570
p[2]       0.204   0.053  0.117  0.168  0.199  0.234  0.322 1.047    38
p[3]       0.496   0.073  0.350  0.448  0.497  0.545  0.636 1.001  3000
deviance  15.119   2.384 12.535 13.373 14.490 16.130 21.782 1.005   320

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = var(deviance)/2)
pD = 2.8 and DIC = 18.0
DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<p><strong>Conclusions</strong>: Initially, we should focus our attention on the Rhat and n.eff columns. These are the scale reduction and number of effective samples respectively and they provide an indication of the degree of mixing or coverage of the samples. Ideally, the n.eff values should be approximately equal to the number of saved samples (in this case <span class="math inline">\(4701\)</span>), and the Rhat values should be approximately <span class="math inline">\(1\)</span> (complete convergence). Whilst the actual values are likely to differ substantially from run to run (due to the stochastic nature of the way the chains traverse the posterior distribution), on this occasion, the n.eff of the first two probability parameters (p[1] and p[2]) are substantially lower than <span class="math inline">\(4700\)</span>. Hence, the samples of these parameters may not accurately reflect the posterior distribution. We might consider altering one or more of the chain behavioural paramters (such as the thinning rate), alter the model definition (or priors) itself.</p>
</div>
<div id="model-evaluation" class="section level2">
<h2>Model evaluation</h2>
<pre class="r"><code>&gt; library(mcmcplots)
&gt; denplot(data.r2jags, parms = c(&quot;p&quot;))</code></pre>
<p><img src="/JAGS/gof-tests-jags/2020-02-01-gof-tests-jags_files/figure-html/mcmc_diag-1.png" width="672" /></p>
<pre class="r"><code>&gt; traplot(data.r2jags, parms = c(&quot;p&quot;))</code></pre>
<p><img src="/JAGS/gof-tests-jags/2020-02-01-gof-tests-jags_files/figure-html/mcmc_diag-2.png" width="672" /></p>
<pre class="r"><code>&gt; 
&gt; raftery.diag(as.mcmc(data.r2jags))
[[1]]

Quantile (q) = 0.025
Accuracy (r) = +/- 0.005
Probability (s) = 0.95 

You need a sample size of at least 3746 with these values of q, r and s

[[2]]

Quantile (q) = 0.025
Accuracy (r) = +/- 0.005
Probability (s) = 0.95 

You need a sample size of at least 3746 with these values of q, r and s
&gt; 
&gt; autocorr.diag(as.mcmc(data.r2jags))
         deviance        p[1]        p[2]        p[3]
Lag 0  1.00000000  1.00000000  1.00000000  1.00000000
Lag 1  0.67862022  0.79329782  0.75266787  0.79501632
Lag 5  0.22316853  0.37163355  0.31066379  0.35879998
Lag 10 0.05470517  0.15225282  0.11155263  0.17106406
Lag 50 0.02781881 -0.00722609 -0.09133568 -0.03525663</code></pre>
<p><strong>Conclusions</strong>: Minimum required number of MCMC samples to ensure that sufficient samples had been collected to achieve good accuracy is <span class="math inline">\(3746\)</span>. We had <span class="math inline">\(5000\)</span> per chain (<span class="math inline">\(5000\times3=15000\)</span>).</p>
<pre class="r"><code>&gt; params &lt;- c(&quot;p&quot;)
&gt; nChains = 2
&gt; burnInSteps = 1000
&gt; thinSteps = 50
&gt; numSavedSteps = 5000
&gt; nIter = ceiling((numSavedSteps * thinSteps)/nChains)
&gt; data.r2jags &lt;- jags(data = data.list, inits = NULL, parameters.to.save = params, 
+                     model.file = &quot;chi2model.txt&quot;, n.chains = nChains, n.iter = nIter,
+                     n.burnin = burnInSteps, n.thin = thinSteps)
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 3
   Unobserved stochastic nodes: 9
   Total graph size: 18

Initializing model
&gt; 
&gt; print(data.r2jags)
Inference for Bugs model at &quot;chi2model.txt&quot;, fit using jags,
 2 chains, each with 125000 iterations (first 1000 discarded), n.thin = 50
 n.sims = 4960 iterations saved
         mu.vect sd.vect   2.5%    25%    50%    75%  97.5%  Rhat n.eff
p[1]       0.325   0.067  0.200  0.279  0.322  0.369  0.459 1.001  5000
p[2]       0.204   0.056  0.105  0.164  0.201  0.240  0.324 1.002  2100
p[3]       0.491   0.070  0.353  0.443  0.490  0.539  0.630 1.001  5000
deviance  15.223   2.356 12.524 13.457 14.647 16.360 21.253 1.002  1700

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = var(deviance)/2)
pD = 2.8 and DIC = 18.0
DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<p><strong>Conclusions</strong>: Rhat and n.eff are now much better for the probability parameters. The estimated fractions for A, B and C are:</p>
<ul>
<li><p>A: 0.327 (0.207, 0.466)</p></li>
<li><p>B: 0.200 (0.104, 0.323)</p></li>
<li><p>C: 0.491 (0.355, 0.625)</p></li>
</ul>
<p>Collectively, the fractions of 1/3, 1/3 and 1/3 do not fall within these ranges. However, collectively the fractions 1/4, 1/4, 2/4 do fall comfortably within these ranges. This suggests that the population ratio is more likely to be 1:1:2 than 1:1:1.</p>
</div>
</div>
<div id="chi-square" class="section level1">
<h1>Chi-square</h1>
<p>An appropriate test statistic for comparing an observed (o) frequency ratio to an expected (e) frequency ratio is the chi-square <span class="math inline">\(\chi^2\)</span> statistic. In effect, the chi-square statistic (which incorporates the variability in the data in to measure of the difference between observed and expected) becomes the input for the likelihood model. Whilst we could simply pass <code>JAGS</code> the chi-square statistic, by parsing the observed and expected values and having the chi-square value calculated within <code>JAGS</code> data, the resulting <code>JAGS</code> code is more complete and able to accommodate other scenarios. So if, chisq is the chi-square statistic and <span class="math inline">\(k\)</span> is the degrees of freedom (and thus expected value of the <span class="math inline">\(\chi^2\)</span> distribution), then the likelihood model is:</p>
<p><span class="math display">\[ \text{chisq} \sim \chi^2(k),\]</span></p>
<p>where <span class="math inline">\(k \sim \text{Unif}(0.01,100)\)</span>.</p>
<div id="exploratory-data-analysis-1" class="section level2">
<h2>Exploratory data analysis</h2>
<p>So lets calculate the expected frequencies as a means to evaluate this assumption. The expected values are calculated as:</p>
<p><span class="math display">\[ e=\text{total counts} \times \text{expected fraction}.\]</span></p>
<p>It is clear that in neither case are any of the expected frequencies less than <span class="math inline">\(5\)</span>. Therefore, we would conclude that probabilities derived from the <span class="math inline">\(\chi^2\)</span> distribution are likely to be reliable.</p>
</div>
<div id="model-fitting-1" class="section level2">
<h2>Model fitting</h2>
<p>We now translate the likelihood model into <code>JAGS</code> code and store the code in an external file.</p>
<pre class="r"><code>&gt; modelString2=&quot;
+ data {
+ for (i in 1:n){
+      resid[i] &lt;- pow(obs[i]-exp[i],2)/exp[i]
+    }
+    chisq &lt;- sum(resid)
+ }
+ model {
+   #Likelihood
+   chisq  ~ dchisqr(k)
+   #Priors
+   k ~ dunif(0.01,100)
+  }
+ &quot;
&gt; ## write the model to a text file 
&gt; writeLines(modelString2,con=&quot;chi2model2.txt&quot;)</code></pre>
<ul>
<li><p>First of all, the standardized residuals and chi-square statistic are calculated according to the formula listed above.</p></li>
<li><p>The likelihood model indicates that the chi-squared statistic can be modeled by a <span class="math inline">\(\chi^2\)</span> distribution with a centrality parameter of <span class="math inline">\(k\)</span>.</p></li>
<li><p>The prior on <span class="math inline">\(k\)</span> is defined as a uniform (thus vague) flat prior whose values could range from <span class="math inline">\(0.01\)</span> to <span class="math inline">\(100\)</span> (all with equal probability).</p></li>
</ul>
<p>Define the data list. This all needs to be contained within a list object. We will create two data lists, one for each of the hypotheses.</p>
<pre class="r"><code>&gt; # The observed item frequencies
&gt; obs &lt;- c(15, 9, 23)
&gt; # The expected item frequencies (for a 1:1:1 ratio)
&gt; exp &lt;- rep(sum(obs) * 1/3, 3)
&gt; data.list &lt;- list(obs = obs, exp = exp, n = 3)
&gt; data.list
$obs
[1] 15  9 23

$exp
[1] 15.66667 15.66667 15.66667

$n
[1] 3
&gt; 
&gt; # The expected item frequencies (for a 1:1:2 ratio)
&gt; exp &lt;- sum(obs) * c(1/4, 1/4, 2/4)
&gt; data.list1 &lt;- list(obs = obs, exp = exp, n = 3)
&gt; data.list1
$obs
[1] 15  9 23

$exp
[1] 11.75 11.75 23.50

$n
[1] 3</code></pre>
<p>Define the parameters to monitor and the chain details</p>
<pre class="r"><code>&gt; params &lt;- c(&quot;chisq&quot;, &quot;resid&quot;, &quot;k&quot;)
&gt; nChains = 2
&gt; burnInSteps = 1000
&gt; thinSteps = 1
&gt; numSavedSteps = 5000
&gt; nIter = ceiling((numSavedSteps * thinSteps)/nChains)</code></pre>
<p>Fit the model in <code>JAGS</code> using the function <code>jags</code> in the package <code>R2jags</code> (which should be loaded first).</p>
<pre class="r"><code>&gt; # Fit the model for the 1:1:1 ratio
&gt; data.r2jags2 &lt;- jags(data = data.list, inits = NULL, parameters.to.save = params, 
+                     model.file = &quot;chi2model2.txt&quot;,n.chains = nChains, n.iter = nIter, 
+                     n.burnin = burnInSteps, n.thin = thinSteps)
Compiling data graph
   Resolving undeclared variables
   Allocating nodes
   Initializing
   Reading data back into data table
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 1
   Unobserved stochastic nodes: 1
   Total graph size: 14

Initializing model
&gt; 
&gt; print(data.r2jags2)
Inference for Bugs model at &quot;chi2model2.txt&quot;, fit using jags,
 2 chains, each with 2500 iterations (first 1000 discarded)
 n.sims = 3000 iterations saved
         mu.vect sd.vect  2.5%   25%   50%    75%  97.5%  Rhat n.eff
chisq      6.298   0.000 6.298 6.298 6.298  6.298  6.298 1.000     1
k          8.293   3.611 2.306 5.686 7.915 10.559 16.165 1.001  3000
resid[1]   0.028   0.000 0.028 0.028 0.028  0.028  0.028 1.000     1
resid[2]   2.837   0.000 2.837 2.837 2.837  2.837  2.837 1.000     1
resid[3]   3.433   0.000 3.433 3.433 3.433  3.433  3.433 1.000     1
deviance   5.338   1.428 4.346 4.444 4.809  5.647  9.405 1.001  3000

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = var(deviance)/2)
pD = 1.0 and DIC = 6.4
DIC is an estimate of expected predictive error (lower deviance is better).
&gt; 
&gt; # Fit the model for the 1:1:2 ratio
&gt; data.r2jags2.1 &lt;- jags(data = data.list1, inits = NULL, parameters.to.save = params, 
+                     model.file = &quot;chi2model2.txt&quot;,n.chains = nChains, n.iter = nIter, 
+                     n.burnin = burnInSteps, n.thin = thinSteps)
Compiling data graph
   Resolving undeclared variables
   Allocating nodes
   Initializing
   Reading data back into data table
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 1
   Unobserved stochastic nodes: 1
   Total graph size: 14

Initializing model
&gt; 
&gt; print(data.r2jags2.1)
Inference for Bugs model at &quot;chi2model2.txt&quot;, fit using jags,
 2 chains, each with 2500 iterations (first 1000 discarded)
 n.sims = 3000 iterations saved
         mu.vect sd.vect  2.5%   25%   50%   75% 97.5%  Rhat n.eff
chisq      1.553   0.000 1.553 1.553 1.553 1.553 1.553 1.000     1
k          3.455   1.909 0.549 2.007 3.185 4.612 7.908 1.002  3000
resid[1]   0.899   0.000 0.899 0.899 0.899 0.899 0.899 1.000     1
resid[2]   0.644   0.000 0.644 0.644 0.644 0.644 0.644 1.000     1
resid[3]   0.011   0.000 0.011 0.011 0.011 0.011 0.011 1.000     1
deviance   3.883   1.426 2.870 2.976 3.334 4.230 8.006 1.003   920

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = var(deviance)/2)
pD = 1.0 and DIC = 4.9
DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
</div>
<div id="model-evaluation-1" class="section level2">
<h2>Model evaluation</h2>
<pre class="r"><code>&gt; denplot(data.r2jags2, parms = c(&quot;k&quot;))</code></pre>
<p><img src="/JAGS/gof-tests-jags/2020-02-01-gof-tests-jags_files/figure-html/mcmc_diag_v2-1.png" width="672" /></p>
<pre class="r"><code>&gt; traplot(data.r2jags2, parms = c(&quot;k&quot;))</code></pre>
<p><img src="/JAGS/gof-tests-jags/2020-02-01-gof-tests-jags_files/figure-html/mcmc_diag_v2-2.png" width="672" /></p>
<pre class="r"><code>&gt; 
&gt; raftery.diag(as.mcmc(data.r2jags2))
[[1]]

Quantile (q) = 0.025
Accuracy (r) = +/- 0.005
Probability (s) = 0.95 

You need a sample size of at least 3746 with these values of q, r and s

[[2]]

Quantile (q) = 0.025
Accuracy (r) = +/- 0.005
Probability (s) = 0.95 

You need a sample size of at least 3746 with these values of q, r and s
&gt; 
&gt; autocorr.diag(as.mcmc(data.r2jags2))
       chisq    deviance           k resid[1] resid[2] resid[3]
Lag 0    NaN  1.00000000  1.00000000      NaN      NaN      NaN
Lag 1    NaN  0.42415918  0.27295298      NaN      NaN      NaN
Lag 5    NaN -0.01961156 -0.01627609      NaN      NaN      NaN
Lag 10   NaN -0.03086926 -0.01043329      NaN      NaN      NaN
Lag 50   NaN -0.01409259 -0.02172076      NaN      NaN      NaN</code></pre>
<p><strong>Conclusions</strong>: The trace plots show what appears to be “random noise” about the parameter value. There is no real suggestion of a step or dramatic change in the trend direction along the length of the sampling chain. The samples seem relatively stable. Thus it would seem that the chains are well mixed and have converged. The density plot (for <span class="math inline">\(k\)</span>) is not symmetrical. This suggests that the mean is not a good point estimate for this parameter - the median would be better.</p>
</div>
<div id="exploring-model-parameters" class="section level2">
<h2>Exploring model parameters</h2>
<pre class="r"><code>&gt; print(data.r2jags2)
Inference for Bugs model at &quot;chi2model2.txt&quot;, fit using jags,
 2 chains, each with 2500 iterations (first 1000 discarded)
 n.sims = 3000 iterations saved
         mu.vect sd.vect  2.5%   25%   50%    75%  97.5%  Rhat n.eff
chisq      6.298   0.000 6.298 6.298 6.298  6.298  6.298 1.000     1
k          8.293   3.611 2.306 5.686 7.915 10.559 16.165 1.001  3000
resid[1]   0.028   0.000 0.028 0.028 0.028  0.028  0.028 1.000     1
resid[2]   2.837   0.000 2.837 2.837 2.837  2.837  2.837 1.000     1
resid[3]   3.433   0.000 3.433 3.433 3.433  3.433  3.433 1.000     1
deviance   5.338   1.428 4.346 4.444 4.809  5.647  9.405 1.001  3000

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = var(deviance)/2)
pD = 1.0 and DIC = 6.4
DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<p><strong>Conclusions</strong>: The median degrees of freedom (<span class="math inline">\(k\)</span>) was <span class="math inline">\(8.00\)</span> with a <span class="math inline">\(95\)</span>% spread of <span class="math inline">\(2.31-16.16\)</span>. This interval does not include the value of <span class="math inline">\(2\)</span> (expected value of the chi2 distribution for this hypothesis). Hence there is evidence that the population ratio deviates from a 1:1:1 ratio.</p>
<pre class="r"><code>&gt; print(data.r2jags2.1)
Inference for Bugs model at &quot;chi2model2.txt&quot;, fit using jags,
 2 chains, each with 2500 iterations (first 1000 discarded)
 n.sims = 3000 iterations saved
         mu.vect sd.vect  2.5%   25%   50%   75% 97.5%  Rhat n.eff
chisq      1.553   0.000 1.553 1.553 1.553 1.553 1.553 1.000     1
k          3.455   1.909 0.549 2.007 3.185 4.612 7.908 1.002  3000
resid[1]   0.899   0.000 0.899 0.899 0.899 0.899 0.899 1.000     1
resid[2]   0.644   0.000 0.644 0.644 0.644 0.644 0.644 1.000     1
resid[3]   0.011   0.000 0.011 0.011 0.011 0.011 0.011 1.000     1
deviance   3.883   1.426 2.870 2.976 3.334 4.230 8.006 1.003   920

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = var(deviance)/2)
pD = 1.0 and DIC = 4.9
DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<p><strong>Conclusions</strong>: The median degrees of freedom (<span class="math inline">\(k\)</span>) was <span class="math inline">\(3.31\)</span> with a <span class="math inline">\(95\)</span>% spread of <span class="math inline">\(0.57-7.61\)</span>. This interval comfortably includes the value of <span class="math inline">\(2\)</span> (expected value of the chi2 distribution for this hypothesis). Hence there is no evidence that the population ratio deviates from a 1:1:2 ratio.</p>
</div>
<div id="exploration-of-the-trends" class="section level2">
<h2>Exploration of the trends</h2>
<p>There are a number of avenues we could take in order to explore the data and models further. One thing we could do is calculate the probability that <span class="math inline">\(k\)</span> is greater than $24 (the expected value) for each hypothesis. This can be done either by modifying the <code>JAGS</code> code to include a derivative that uses the step function, or we can derive it within <code>R</code> from the <span class="math inline">\(k\)</span> samples. Lets explore the latter.</p>
<pre class="r"><code>&gt; k &lt;- data.r2jags2$BUGSoutput$sims.matrix[, &quot;k&quot;]
&gt; pr &lt;- sum(k &gt; 2)/length(k)
&gt; pr
[1] 0.9813333
&gt; 
&gt; k &lt;- data.r2jags2.1$BUGSoutput$sims.matrix[, &quot;k&quot;]
&gt; pr1 &lt;- sum(k &gt; 2)/length(k)
&gt; pr1
[1] 0.7513333</code></pre>
<p><strong>Conclusions</strong>: the probability that the expected value exceeds <span class="math inline">\(2\)</span> for the 1:1:1 hypothesis is <span class="math inline">\(0.982\)</span> (<span class="math inline">\(98.2\)</span>%). There is an <span class="math inline">\(98.2\)</span>% likelihood that the population is not 1:1:1.
We could also compare the two alternative hypotheses. The 1:1:2 hypothesis has lower DIC and is therefore considered a better fit (<span class="math inline">\(4.7\)</span> vs <span class="math inline">\(6.4\)</span>). This is a difference in DIC of around <span class="math inline">\(1.7\)</span> units. So the data have higher support for a 1:1:2 population ratio than a 1:1:1 ratio.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-plummer2004jags">
<p>Plummer, Martyn. 2004. “JAGS: Just Another Gibbs Sampler.”</p>
</div>
<div id="ref-su2015package">
<p>Su, Yu-Sung, Masanao Yajima, Maintainer Yu-Sung Su, and JAGS SystemRequirements. 2015. “Package ‘R2jags’.” <em>R Package Version 0.03-08, URL Http://CRAN. R-Project. Org/Package= R2jags</em>.</p>
</div>
</div>
</div>

    </div>

    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/tutorials/">tutorials</a>
  
  <a class="badge badge-light" href="/tags/jags/">JAGS</a>
  
  <a class="badge badge-light" href="/tags/goodness-of-fit-tests/">goodness of fit tests</a>
  
  <a class="badge badge-light" href="/tags/frequency-analysis/">frequency analysis</a>
  
</div>



    
      








  
  
    
  
  





  
  
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="/authors/andrea-gabrio/"></a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/jags/partly-nested-anova-jags/block-anova-jags/">Partly Nested Anova - JAGS</a></li>
          
          <li><a href="/jags/block-anova-jags/block-anova-jags/">Randomised Complete Block Anova - JAGS</a></li>
          
          <li><a href="/jags/nested-anova-jags/netsed-anova-jags/">Nested Anova - JAGS</a></li>
          
          <li><a href="/jags/autocorrelation-jags/autocorrelation-jags/">Temporal Autocorrelation - JAGS</a></li>
          
          <li><a href="/jags/heterogeneity-jags/heterogeneity-jags/">Variance Heterogeneity - JAGS</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin="anonymous"></script>
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.3394a224b26ce58ff36f44c54743e0ab.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">

  <p class="powered-by">
    &#169; Andrea Gabrio &middot;
    <code>2020</code> 
    &middot; Based on the 
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
