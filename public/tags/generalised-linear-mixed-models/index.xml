<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>generalised linear mixed models on Andrea Gabrio</title>
    <link>/tags/generalised-linear-mixed-models/</link>
    <description>Recent content in generalised linear mixed models on Andrea Gabrio</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator>
    <language>en-us</language>
    <copyright>`{year}`</copyright>
    <lastBuildDate>Sat, 15 Feb 2020 21:13:14 -0500</lastBuildDate>
    
	    <atom:link href="/tags/generalised-linear-mixed-models/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Generalised Linear Mixed Models - JAGS</title>
      <link>/jags/glmm-jags/glmm-jags/</link>
      <pubDate>Sat, 15 Feb 2020 21:13:14 -0500</pubDate>
      
      <guid>/jags/glmm-jags/glmm-jags/</guid>
      <description>


&lt;p&gt;This tutorial will focus on the use of Bayesian estimation to fit simple linear regression models. &lt;code&gt;BUGS&lt;/code&gt; (Bayesian inference Using &lt;em&gt;Gibbs Sampling&lt;/em&gt;) is an algorithm and supporting language (resembling &lt;code&gt;R&lt;/code&gt;) dedicated to performing the Gibbs sampling implementation of &lt;em&gt;Markov Chain Monte Carlo&lt;/em&gt; (MCMC) method. Dialects of the &lt;code&gt;BUGS&lt;/code&gt; language are implemented within three main projects:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;OpenBUGS&lt;/strong&gt; - written in component pascal.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;JAGS&lt;/strong&gt; - (Just Another Gibbs Sampler) - written in &lt;code&gt;C++&lt;/code&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;STAN&lt;/strong&gt; - a dedicated Bayesian modelling framework written in &lt;code&gt;C++&lt;/code&gt; and implementing &lt;em&gt;Hamiltonian&lt;/em&gt; MCMC samplers.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Whilst the above programs can be used stand-alone, they do offer the rich data pre-processing and graphical capabilities of &lt;code&gt;R&lt;/code&gt;, and thus, they are best accessed from within &lt;code&gt;R&lt;/code&gt; itself. As such there are multiple packages devoted to interfacing with the various software implementations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;R2OpenBUGS&lt;/em&gt; - interfaces with &lt;code&gt;OpenBUGS&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;R2jags&lt;/em&gt; - interfaces with &lt;code&gt;JAGS&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;rstan&lt;/em&gt; - interfaces with &lt;code&gt;STAN&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This tutorial will demonstrate how to fit models in &lt;code&gt;JAGS&lt;/code&gt; (&lt;span class=&#34;citation&#34;&gt;Plummer (2004)&lt;/span&gt;) using the package &lt;code&gt;R2jags&lt;/code&gt; (&lt;span class=&#34;citation&#34;&gt;Su et al. (2015)&lt;/span&gt;) as interface, which also requires to load some other packages.&lt;/p&gt;
&lt;div id=&#34;overview&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Overview&lt;/h1&gt;
&lt;p&gt;In some respects, &lt;em&gt;Generalized Linear Mixed effects Models&lt;/em&gt; (GLMM) are a hierarchical extension of &lt;em&gt;Generalized linear models&lt;/em&gt; (GLM) in a similar manner that Linear Mixed effects Models (LMM) are a hierarchical extension of Linear Models (LM). However, whilst the Gaussian (normal) distribution facilitates a relatively straight way of generating the marginal likelihood of the observed response by integrating likelihoods across all possible (and unobserved) levels of a random effect to yield parameter estimates, the same cannot be said for other distributions. Consequently various approximations have been developed to estimate the fixed and random parameters for GLMM’s:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Penalized quasi-likelihood&lt;/strong&gt; (PQL). This method approximates a quasi-likelihood by iterative fitting of (re)weighted linear mixed effects models based on the fit of GLM fit. Specifically, it estimates the fixed effects parameters by fitting a GLM that incorporates a correlation (variance-covariance) structure resulting from a LMM and then refits a LMM to re-estimate the variance-covariance structure by using the variance structure from the previous GLM. The cycle continues to iterate until either the fit improvement is below a threshold or a defined number of iterations has occurred. Whilst this is a relatively simple approach, that enables us to leverage methodologies for accommodating heterogeneity and spatial/temporal autocorrelation, it is known to perform poorly (estimates biased towards large variance) for Poisson distributions when the expected value is less than &lt;span class=&#34;math inline&#34;&gt;\(5\)&lt;/span&gt; and for binary data when the expected number of successes or failures are less than &lt;span class=&#34;math inline&#34;&gt;\(5\)&lt;/span&gt;. Moreover, as it approximates quasi-likelihood rather than likelihood, likelihood based inference and information criterion methods (such as likelihood ratio tests and AIC) are not appropriate with this approach. Instead, Wald tests are required for inference.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Laplace approximation&lt;/strong&gt;. This approach utilises a second-order Taylor series expansion to approximate (a mathematical technique for approximating the properties of a function around a point by taking multiple derivatives of the function and summing them together) the likelihood function. If we assume that the likelihood function is approximately normal and thus a quadratic function on a log scale, we can use second-order Taylor series expansion to approximate this likelihood. Whilst this approach is considered to be more accurate than PQL, it is considerably slower and unable to accommodate alternative variance and correlation structures.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Gauss-Hermite quadrature&lt;/strong&gt; (GHQ). This approach approximates the marginal likelihood by approximating the value of integrals at specific points (quadratures). This technique can be further adapted by allowing the number of quadratures and their weights to be optimized via a set of rules.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Markov-chain Monte-Carlo&lt;/strong&gt; (MCMC). This takes a bruit force approach by recreating the likelihood by traversing the likelihood function with sequential sampling proportional to the likelihood. Although this approach is very robust (when the posteriors have converged), they are computationally very intense. Interestingly, some (including Andrew Gelman) argue that PQL, Laplace and GHQ do not yield estimates. Rather they are only approximations of estimates. By contrast, as MCMC methods are able to integrate over all levels by bruit force, the resulting parameters are indeed true estimates.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We will focus on the last approach which is the more general among the ones considered here and which is based on a Bayesian approach, which can be very flexible and accurate, yet very slow and complex.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;hierarchical-poisson-regression&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Hierarchical Poisson regression&lt;/h1&gt;
&lt;p&gt;The model I will be developing is a Bayesian hierarchical Poisson regression model which I borrow from a very interesting work about modelling match results in soccer, available both as a &lt;a href=&#34;http://www.sumsar.net/papers/baath_2015_modeling_match_resluts_in_soccer.pdf&#34;&gt;technical report&lt;/a&gt; and as a series of &lt;a href=&#34;http://www.sumsar.net/blog/2013/07/modeling-match-results-in-la-liga-part-one/&#34;&gt;online posts&lt;/a&gt;. The objective of the analysis was to model the match results from the last five seasons of &lt;em&gt;La Liga&lt;/em&gt;, the premium Spanish football (soccer) league. In total there were &lt;span class=&#34;math inline&#34;&gt;\(1900\)&lt;/span&gt; rows in the dataset each with information regarding which was the home and away team, what these teams scored and what season it was. The goal outcomes of the teams are assumed to be distributed according to a Poisson distribution, while also taking into account the dependence between the goals scored by the attacking and defensive teams in each match.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;loading-the-data&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Loading the data&lt;/h1&gt;
&lt;p&gt;I start by loading libraries, reading in the data and preprocessing it for &lt;code&gt;JAGS&lt;/code&gt;. The last &lt;span class=&#34;math inline&#34;&gt;\(50\)&lt;/span&gt; matches have unknown outcomes and I create a new data frame &lt;code&gt;d&lt;/code&gt; holding only matches with known outcomes. I will come back to the unknown outcomes later when it is time to use the model for prediction. I also load a &lt;code&gt;R&lt;/code&gt; function called &lt;code&gt;plotPost&lt;/code&gt; which was previously coded in order to facilitate the plotting of the posterior results of the model. All information about the model structure, data and functions can be found on the webpage of the original post of the author or in his technical report (&lt;span class=&#34;citation&#34;&gt;Bååth (2015)&lt;/span&gt;).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; library(R2jags)
&amp;gt; library(coda)
&amp;gt; library(mcmcplots)
&amp;gt; library(stringr)
&amp;gt; library(plyr)
&amp;gt; library(xtable)
&amp;gt; library(ggplot2)
&amp;gt; source(&amp;quot;plotPost.R&amp;quot;)
&amp;gt; set.seed(12345)  # for reproducibility
&amp;gt; 
&amp;gt; load(&amp;quot;laliga.RData&amp;quot;)
&amp;gt; 
&amp;gt; # -1 = Away win, 0 = Draw, 1 = Home win
&amp;gt; laliga$MatchResult &amp;lt;- sign(laliga$HomeGoals - laliga$AwayGoals)
&amp;gt; 
&amp;gt; # Creating a data frame d with only the complete match results
&amp;gt; d &amp;lt;- na.omit(laliga)
&amp;gt; teams &amp;lt;- unique(c(d$HomeTeam, d$AwayTeam))
&amp;gt; seasons &amp;lt;- unique(d$Season)
&amp;gt; 
&amp;gt; # A list for JAGS with the data from d where the strings are coded as
&amp;gt; # integers
&amp;gt; data_list &amp;lt;- list(HomeGoals = d$HomeGoals, AwayGoals = d$AwayGoals, HomeTeam = as.numeric(factor(d$HomeTeam,
+     levels = teams)), AwayTeam = as.numeric(factor(d$AwayTeam, levels = teams)),
+     Season = as.numeric(factor(d$Season, levels = seasons)), n_teams = length(teams),
+     n_games = nrow(d), n_seasons = length(seasons))
&amp;gt; 
&amp;gt; # Convenience function to generate the type of column names Jags outputs.
&amp;gt; col_name &amp;lt;- function(name, ...) {
+     paste0(name, &amp;quot;[&amp;quot;, paste(..., sep = &amp;quot;,&amp;quot;), &amp;quot;]&amp;quot;)
+ }
&amp;gt; data_list$n_seasons&amp;lt;-NULL
&amp;gt; data_list$Season&amp;lt;-NULL&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;modeling-match-results&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Modeling Match Results&lt;/h1&gt;
&lt;div id=&#34;data-check&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Data check&lt;/h2&gt;
&lt;p&gt;How are the number of goals for each team in a football match distributed? Well, let’s start by assuming that all football matches are roughly equally long, that both teams have many chances at making a goal and that each team have the same probability of making a goal each goal chance. Given these assumptions the distribution of the number of goals for each team should be well captured by a Poisson distribution. A quick and dirty comparison between the actual distribution of the number of scored goals and a Poisson distribution having the same mean number of scored goals support this notion.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; par(mfcol = c(2, 1), mar = rep(2.2, 4))
&amp;gt; hist(c(d$AwayGoals, d$HomeGoals), xlim = c(-0.5, 8), breaks = -1:9 + 0.5, main = &amp;quot;Distribution of the number of goals\nscored by a team in a match.&amp;quot;)
&amp;gt; mean_goals &amp;lt;- mean(c(d$AwayGoals, d$HomeGoals))
&amp;gt; hist(rpois(9999, mean_goals), xlim = c(-0.5, 8), breaks = -1:9 + 0.5, main = &amp;quot;Random draw from a Poisson distribution with\nthe same mean as the distribution above.&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/data_check-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;model-fitting&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Model fitting&lt;/h2&gt;
&lt;p&gt;All teams aren’t equally good and it will be assumed that all teams have a latent skill variable and the skill of a team minus the skill of the opposing team defines the predicted outcome of a game. As the number of goals are assumed to be Poisson distributed it is natural that the skills of the teams are on the log scale of the mean of the distribution. The distribution of the number of goals for team &lt;span class=&#34;math inline&#34;&gt;\(i\)&lt;/span&gt; when facing team &lt;span class=&#34;math inline&#34;&gt;\(j\)&lt;/span&gt; is then&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{Goals} \sim \text{Pois}(\lambda)\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;where &lt;span class=&#34;math inline&#34;&gt;\(\log(\lambda)=\text{baseline} + \text{skill}_i - \text{skill}_j\)&lt;/span&gt;. Baseline is the log average number of goals when both teams are equally good. The goal outcome of a match between home team &lt;span class=&#34;math inline&#34;&gt;\(i\)&lt;/span&gt; and away team &lt;span class=&#34;math inline&#34;&gt;\(j\)&lt;/span&gt; is modeled as:&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{HomeGoals}_{ij} \sim \text{Pois}(\lambda_{\text{home},ij}),\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{AwayGoals}_{ij} \sim \text{Pois}(\lambda_{\text{away},ij}),\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;where&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \log(\lambda_{\text{home},ij}) = \text{baseline} + \text{skill}_i - \text{skill}_j, \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \log(\lambda_{\text{away},ij}) = \text{baseline} + \text{skill}_j - \text{skill}_i. \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Add some priors to that and you’ve got a Bayesian model going! I set the prior distributions over the baseline to:&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{baseline} \sim N(0, 4^2),\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;and the skill of all &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; teams using a hierarchical approach to :&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{skill}_{1,\ldots,n} \sim N(\mu_{\text{teams}}, \sigma^2_{\text{teams}}),\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;so that teams are assumed to have similar but not identical mean and variance parameters for thier skill parameters. These priors are made vague. For example, the prior on the baseline have a SD of &lt;code&gt;4&lt;/code&gt; but since this is on the log scale of the mean number of goals it corresponds to one SD from the mean &lt;code&gt;0&lt;/code&gt; covering the range of &lt;code&gt;[0.02,54.6]&lt;/code&gt; goals. Turning this into a &lt;code&gt;JAGS&lt;/code&gt; model requires some minor adjustments. The model have to loop over all the match results, which adds some for-loops. &lt;code&gt;JAGS&lt;/code&gt; parameterises the normal distribution with precision (the reciprocal of the variance) instead of variance so the hyperpriors have to be converted. Finally I have to “anchor” the skill of one team to a constant otherwise the mean skill can drift away freely (&lt;em&gt;conrner constraint&lt;/em&gt;) and the model cannot be identified. Doing these adjustments results in the following model description:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; m1_string &amp;lt;- &amp;quot;model {
+ for(i in 1:n_games) {
+   HomeGoals[i] ~ dpois(lambda_home[HomeTeam[i],AwayTeam[i]])
+   AwayGoals[i] ~ dpois(lambda_away[HomeTeam[i],AwayTeam[i]])
+ }
+ 
+ for(home_i in 1:n_teams) {
+   for(away_i in 1:n_teams) {
+     lambda_home[home_i, away_i] &amp;lt;- exp(baseline + skill[home_i] - skill[away_i])
+     lambda_away[home_i, away_i] &amp;lt;- exp(baseline + skill[away_i] - skill[home_i])
+   }
+ }
+ 
+ skill[1] &amp;lt;- 0
+ for(j in 2:n_teams) {
+   skill[j] ~ dnorm(group_skill, group_tau)
+ }  
+ 
+ group_skill ~ dnorm(0, 0.0625)
+ group_tau &amp;lt;- 1 / pow(group_sigma, 2)
+ group_sigma ~ dunif(0, 3)
+ baseline ~ dnorm(0, 0.0625)
+ }
+ &amp;quot;
&amp;gt; 
&amp;gt; ## write the model to a text file
&amp;gt; writeLines(m1_string, con = &amp;quot;model1.txt&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Next, we define the nodes (parameters and derivatives) to monitor and the chain parameters.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; params &amp;lt;- c(&amp;quot;baseline&amp;quot;, &amp;quot;skill&amp;quot;, &amp;quot;group_skill&amp;quot;, &amp;quot;group_sigma&amp;quot;)
&amp;gt; nChains = 2
&amp;gt; burnInSteps = 3000
&amp;gt; thinSteps = 1
&amp;gt; numSavedSteps = 15000  #across all chains
&amp;gt; nIter = ceiling(burnInSteps + (numSavedSteps * thinSteps)/nChains)
&amp;gt; nIter
[1] 10500&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Start the &lt;code&gt;JAGS&lt;/code&gt; model (check the model, load data into the model, specify the number of chains and compile the model). Run the &lt;code&gt;JAGS&lt;/code&gt; code via the &lt;code&gt;R2jags&lt;/code&gt; interface and the &lt;code&gt;jags&lt;/code&gt; function. Note that the first time jags is run after the &lt;code&gt;R2jags&lt;/code&gt; package is loaded, it is often necessary to run any kind of randomisation function just to initiate the .Random.seed variable.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; m1.r2jags &amp;lt;- jags(data = data_list, inits = NULL, parameters.to.save = params,
+     model.file = &amp;quot;model1.txt&amp;quot;, n.chains = nChains, n.iter = nIter,
+     n.burnin = burnInSteps, n.thin = thinSteps)
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 3700
   Unobserved stochastic nodes: 31
   Total graph size: 9151

Initializing model
&amp;gt; 
&amp;gt; print(m1.r2jags)
Inference for Bugs model at &amp;quot;model1.txt&amp;quot;, fit using jags,
 2 chains, each with 10500 iterations (first 3000 discarded)
 n.sims = 15000 iterations saved
              mu.vect sd.vect      2.5%       25%       50%       75%     97.5%
baseline        0.281   0.014     0.253     0.271     0.281     0.291     0.309
group_sigma     0.225   0.034     0.169     0.201     0.222     0.246     0.302
group_skill     0.016   0.062    -0.104    -0.026     0.016     0.057     0.136
skill[1]        0.000   0.000     0.000     0.000     0.000     0.000     0.000
skill[2]        0.185   0.061     0.064     0.145     0.185     0.226     0.307
skill[3]        0.017   0.069    -0.117    -0.030     0.017     0.064     0.154
skill[4]       -0.013   0.061    -0.132    -0.054    -0.013     0.028     0.109
skill[5]       -0.180   0.098    -0.376    -0.247    -0.179    -0.113     0.008
skill[6]       -0.048   0.063    -0.170    -0.090    -0.049    -0.007     0.081
skill[7]       -0.013   0.058    -0.128    -0.051    -0.013     0.025     0.103
skill[8]        0.199   0.060     0.084     0.159     0.199     0.240     0.317
skill[9]       -0.077   0.063    -0.200    -0.119    -0.076    -0.034     0.046
skill[10]      -0.110   0.062    -0.230    -0.152    -0.110    -0.068     0.011
skill[11]       0.698   0.057     0.588     0.658     0.696     0.736     0.811
skill[12]       0.133   0.060     0.017     0.092     0.133     0.174     0.249
skill[13]       0.017   0.059    -0.096    -0.023     0.016     0.057     0.132
skill[14]       0.038   0.061    -0.078    -0.003     0.037     0.080     0.160
skill[15]      -0.008   0.060    -0.124    -0.048    -0.009     0.033     0.108
skill[16]      -0.117   0.099    -0.305    -0.186    -0.118    -0.051     0.080
skill[17]       0.606   0.058     0.495     0.566     0.606     0.646     0.720
skill[18]      -0.071   0.070    -0.205    -0.118    -0.072    -0.026     0.071
skill[19]      -0.115   0.069    -0.247    -0.162    -0.115    -0.068     0.022
skill[20]       0.075   0.064    -0.045     0.032     0.074     0.117     0.204
skill[21]      -0.104   0.065    -0.231    -0.148    -0.105    -0.060     0.027
skill[22]      -0.212   0.099    -0.403    -0.281    -0.213    -0.146    -0.017
skill[23]      -0.161   0.101    -0.360    -0.230    -0.159    -0.094     0.036
skill[24]      -0.118   0.101    -0.319    -0.186    -0.118    -0.050     0.085
skill[25]       0.009   0.071    -0.131    -0.037     0.010     0.057     0.147
skill[26]       0.058   0.069    -0.079     0.011     0.058     0.104     0.195
skill[27]      -0.061   0.080    -0.218    -0.115    -0.060    -0.005     0.088
skill[28]      -0.118   0.079    -0.272    -0.170    -0.119    -0.065     0.037
skill[29]      -0.059   0.105    -0.260    -0.130    -0.062     0.011     0.155
deviance    10912.856   7.406 10900.319 10907.610 10912.214 10917.514 10928.852
             Rhat n.eff
baseline    1.001 15000
group_sigma 1.002  1500
group_skill 1.002  1600
skill[1]    1.000     1
skill[2]    1.005   410
skill[3]    1.009   180
skill[4]    1.007   670
skill[5]    1.002  2400
skill[6]    1.001  4400
skill[7]    1.002  2400
skill[8]    1.001 11000
skill[9]    1.001 15000
skill[10]   1.009   190
skill[11]   1.001  4700
skill[12]   1.005   340
skill[13]   1.001 14000
skill[14]   1.006   310
skill[15]   1.002  2600
skill[16]   1.003 12000
skill[17]   1.001 15000
skill[18]   1.002  2700
skill[19]   1.003   880
skill[20]   1.002  1800
skill[21]   1.002  1000
skill[22]   1.001  2800
skill[23]   1.001 15000
skill[24]   1.005   380
skill[25]   1.001 15000
skill[26]   1.002  2300
skill[27]   1.001 15000
skill[28]   1.001 15000
skill[29]   1.001 13000
deviance    1.001  3900

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = var(deviance)/2)
pD = 27.4 and DIC = 10940.3
DIC is an estimate of expected predictive error (lower deviance is better).&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;mcmc-diagnostics&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;MCMC diagnostics&lt;/h2&gt;
&lt;p&gt;Using the generated MCMC samples I can now look at the credible skill values of any team. Let’s look at the trace plot and the distribution of the skill parameters for FC Sevilla and FC Valencia.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; team_par&amp;lt;-c(which(teams == c(&amp;quot;FC Sevilla&amp;quot;)), which(teams == &amp;quot;FC Valencia&amp;quot;))
&amp;gt; denplot(m1.r2jags, parms = team_par, style = &amp;quot;plain&amp;quot;, main = c(&amp;quot;Sevilla&amp;quot;,&amp;quot;Valenica&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/mcmc_diag-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; traplot(m1.r2jags, parms = team_par, style = &amp;quot;plain&amp;quot;, main = c(&amp;quot;Sevilla&amp;quot;,&amp;quot;Valenica&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/mcmc_diag-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;model-validation&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Model validation&lt;/h2&gt;
&lt;p&gt;Seems like Sevilla and Valencia have similar skill with Valencia being slightly better. Using the MCMC samples it is not only possible to look at the distribution of parameter values but it is also straight forward to simulate matches between teams and look at the credible distribution of number of goals scored and the probability of a win for the home team, a win for the away team or a draw. The following functions simulates matches with one team as home team and one team as away team and plots the predicted result together with the actual outcomes of any matches in the &lt;code&gt;laliga&lt;/code&gt; data set.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; # Plots histograms over home_goals, away_goals, the difference in goals
&amp;gt; # and a barplot over match results.
&amp;gt; plot_goals &amp;lt;- function(home_goals, away_goals) {
+     n_matches &amp;lt;- length(home_goals)
+     goal_diff &amp;lt;- home_goals - away_goals
+     match_result &amp;lt;- ifelse(goal_diff &amp;lt; 0, &amp;quot;away_win&amp;quot;, ifelse(goal_diff &amp;gt; 0,
+         &amp;quot;home_win&amp;quot;, &amp;quot;equal&amp;quot;))
+     hist(home_goals, xlim = c(-0.5, 10), breaks = (0:100) - 0.5)
+     hist(away_goals, xlim = c(-0.5, 10), breaks = (0:100) - 0.5)
+     hist(goal_diff, xlim = c(-6, 6), breaks = (-100:100) - 0.5)
+     barplot(table(match_result)/n_matches, ylim = c(0, 1))
+ }
&amp;gt; 
&amp;gt; 
&amp;gt; plot_pred_comp1 &amp;lt;- function(home_team, away_team, ms) {
+     # Simulates and plots game goals scores using the MCMC samples from the m1
+     # model.
+     par(mar=c(2,2,2,2))
+     par(mfrow = c(2, 4))
+     baseline &amp;lt;- ms[, &amp;quot;baseline&amp;quot;]
+     home_skill &amp;lt;- ms[, which(teams == home_team)]
+     away_skill &amp;lt;- ms[, which(teams == away_team)]
+     home_goals &amp;lt;- rpois(nrow(ms), exp(baseline + home_skill - away_skill))
+     away_goals &amp;lt;- rpois(nrow(ms), exp(baseline + away_skill - home_skill))
+     plot_goals(home_goals, away_goals)
+     # Plots the actual distribution of goals between the two teams
+     home_goals &amp;lt;- d$HomeGoals[d$HomeTeam == home_team &amp;amp; d$AwayTeam == away_team]
+     away_goals &amp;lt;- d$AwayGoals[d$HomeTeam == home_team &amp;amp; d$AwayTeam == away_team]
+     plot_goals(home_goals, away_goals)
+ }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s look at Valencia (home team) vs. Sevilla (away team). The graph below shows the simulation on the first row and the historical data on the second row.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; ms1&amp;lt;-as.matrix(m1.r2jags$BUGSoutput$sims.matrix)
&amp;gt; plot_pred_comp1(&amp;quot;FC Valencia&amp;quot;, &amp;quot;FC Sevilla&amp;quot;, ms1)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/mcmc_val2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Here we discover a problem with the current model. While the simulated data looks the same, except that the home team and the away team swapped places, the historical data now shows that Sevilla often wins against Valencia when being the home team. Our model doesn’t predict this because it doesn’t considers the advantage of being the home team.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;accounting-for-home-advantage&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Accounting for home advantage&lt;/h1&gt;
&lt;p&gt;The only change to the model needed to account for the home advantage is to split the baseline into two components, a home baseline and an away baseline. The following &lt;code&gt;JAGS&lt;/code&gt; model implements this change by splitting &lt;code&gt;baseline&lt;/code&gt; into &lt;code&gt;home_baseline&lt;/code&gt; and &lt;code&gt;away_baseline&lt;/code&gt;.&lt;/p&gt;
&lt;div id=&#34;model-fitting-1&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Model fitting&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; # model 2
&amp;gt; m2_string &amp;lt;- &amp;quot;model {
+ for(i in 1:n_games) {
+   HomeGoals[i] ~ dpois(lambda_home[HomeTeam[i],AwayTeam[i]])
+   AwayGoals[i] ~ dpois(lambda_away[HomeTeam[i],AwayTeam[i]])
+ }
+ 
+ for(home_i in 1:n_teams) {
+   for(away_i in 1:n_teams) {
+     lambda_home[home_i, away_i] &amp;lt;- exp( home_baseline + skill[home_i] - skill[away_i])
+     lambda_away[home_i, away_i] &amp;lt;- exp( away_baseline + skill[away_i] - skill[home_i])
+   }
+ }
+ 
+ skill[1] &amp;lt;- 0 
+ for(j in 2:n_teams) {
+   skill[j] ~ dnorm(group_skill, group_tau)
+ }
+ 
+ group_skill ~ dnorm(0, 0.0625)
+ group_tau &amp;lt;- 1/pow(group_sigma, 2)
+ group_sigma ~ dunif(0, 3)
+ 
+ home_baseline ~ dnorm(0, 0.0625)
+ away_baseline ~ dnorm(0, 0.0625)
+ }
+ &amp;quot;
&amp;gt; 
&amp;gt; ## write the model to a text file
&amp;gt; writeLines(m2_string, con = &amp;quot;model2.txt&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And now re-fit the model&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; params &amp;lt;- c(&amp;quot;home_baseline&amp;quot;, &amp;quot;away_baseline&amp;quot;, &amp;quot;skill&amp;quot;, &amp;quot;group_sigma&amp;quot;, &amp;quot;group_skill&amp;quot;)
&amp;gt; nChains = 2
&amp;gt; burnInSteps = 3000
&amp;gt; thinSteps = 1
&amp;gt; numSavedSteps = 15000  #across all chains
&amp;gt; nIter = ceiling(burnInSteps + (numSavedSteps * thinSteps)/nChains)
&amp;gt; 
&amp;gt; m2.r2jags &amp;lt;- jags(data = data_list, inits = NULL, parameters.to.save = params,
+     model.file = &amp;quot;model2.txt&amp;quot;, n.chains = nChains, n.iter = nIter,
+     n.burnin = burnInSteps, n.thin = thinSteps)
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 3700
   Unobserved stochastic nodes: 32
   Total graph size: 10863

Initializing model
&amp;gt; 
&amp;gt; print(m2.r2jags)
Inference for Bugs model at &amp;quot;model2.txt&amp;quot;, fit using jags,
 2 chains, each with 10500 iterations (first 3000 discarded)
 n.sims = 15000 iterations saved
                mu.vect sd.vect      2.5%       25%       50%       75%
away_baseline     0.081   0.022     0.038     0.067     0.082     0.096
group_sigma       0.226   0.035     0.169     0.201     0.221     0.246
group_skill       0.019   0.061    -0.102    -0.022     0.019     0.060
home_baseline     0.449   0.019     0.413     0.436     0.449     0.462
skill[1]          0.000   0.000     0.000     0.000     0.000     0.000
skill[2]          0.187   0.061     0.066     0.147     0.187     0.228
skill[3]          0.017   0.068    -0.120    -0.030     0.017     0.063
skill[4]         -0.011   0.058    -0.126    -0.050    -0.011     0.028
skill[5]         -0.179   0.100    -0.375    -0.246    -0.178    -0.111
skill[6]         -0.044   0.062    -0.167    -0.087    -0.045    -0.002
skill[7]         -0.009   0.061    -0.127    -0.050    -0.009     0.033
skill[8]          0.199   0.059     0.081     0.159     0.201     0.240
skill[9]         -0.078   0.063    -0.205    -0.121    -0.077    -0.035
skill[10]        -0.108   0.064    -0.234    -0.151    -0.108    -0.066
skill[11]         0.699   0.057     0.583     0.661     0.699     0.737
skill[12]         0.132   0.059     0.019     0.092     0.132     0.173
skill[13]         0.025   0.061    -0.097    -0.016     0.025     0.065
skill[14]         0.041   0.059    -0.074     0.000     0.041     0.081
skill[15]        -0.006   0.060    -0.125    -0.046    -0.005     0.035
skill[16]        -0.115   0.099    -0.311    -0.181    -0.116    -0.049
skill[17]         0.611   0.059     0.494     0.571     0.612     0.653
skill[18]        -0.068   0.070    -0.204    -0.115    -0.069    -0.020
skill[19]        -0.114   0.070    -0.252    -0.162    -0.113    -0.065
skill[20]         0.077   0.062    -0.047     0.035     0.077     0.118
skill[21]        -0.102   0.064    -0.228    -0.145    -0.101    -0.058
skill[22]        -0.202   0.098    -0.399    -0.266    -0.201    -0.138
skill[23]        -0.167   0.098    -0.361    -0.233    -0.167    -0.102
skill[24]        -0.115   0.099    -0.306    -0.183    -0.116    -0.049
skill[25]         0.010   0.071    -0.132    -0.035     0.010     0.057
skill[26]         0.061   0.069    -0.075     0.014     0.062     0.109
skill[27]        -0.059   0.078    -0.211    -0.112    -0.060    -0.007
skill[28]        -0.113   0.082    -0.274    -0.167    -0.113    -0.058
skill[29]        -0.051   0.105    -0.265    -0.121    -0.050     0.021
deviance      10742.730   7.596 10729.548 10737.288 10742.120 10747.534
                  97.5%  Rhat n.eff
away_baseline     0.126 1.002  1600
group_sigma       0.305 1.001 15000
group_skill       0.138 1.006   330
home_baseline     0.486 1.001 15000
skill[1]          0.000 1.000     1
skill[2]          0.306 1.005   380
skill[3]          0.149 1.006   310
skill[4]          0.102 1.002  1900
skill[5]          0.013 1.002  1100
skill[6]          0.076 1.005   400
skill[7]          0.110 1.004   440
skill[8]          0.312 1.008   240
skill[9]          0.045 1.003   620
skill[10]         0.014 1.005   330
skill[11]         0.811 1.004   580
skill[12]         0.245 1.008   200
skill[13]         0.144 1.003   840
skill[14]         0.154 1.003   700
skill[15]         0.111 1.008   210
skill[16]         0.078 1.006   300
skill[17]         0.722 1.005   420
skill[18]         0.070 1.005   360
skill[19]         0.019 1.007   290
skill[20]         0.200 1.006   310
skill[21]         0.025 1.010   170
skill[22]        -0.009 1.002  1600
skill[23]         0.028 1.003   900
skill[24]         0.078 1.006   330
skill[25]         0.151 1.007   240
skill[26]         0.196 1.003   770
skill[27]         0.097 1.001  3900
skill[28]         0.051 1.002  1800
skill[29]         0.153 1.003   620
deviance      10759.025 1.004   460

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = var(deviance)/2)
pD = 28.8 and DIC = 10771.5
DIC is an estimate of expected predictive error (lower deviance is better).&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;mcmc-diagnostics-1&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;MCMC diagnostics&lt;/h2&gt;
&lt;p&gt;Looking at the trace plots and distributions of &lt;code&gt;home_baseline&lt;/code&gt; and &lt;code&gt;away_baseline&lt;/code&gt; shows that there is a considerable home advantage.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; team_par&amp;lt;-c(&amp;quot;home_baseline&amp;quot;, &amp;quot;away_baseline&amp;quot;)
&amp;gt; denplot(m2.r2jags, parms = team_par, style = &amp;quot;plain&amp;quot;, main = c(&amp;quot;home_baseline&amp;quot;,&amp;quot;away_baseline&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/mcmc_diag_m2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; traplot(m2.r2jags, parms = team_par, style = &amp;quot;plain&amp;quot;, main = c(&amp;quot;home_baseline&amp;quot;,&amp;quot;away_baseline&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/mcmc_diag_m2-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;model-validation-1&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Model validation&lt;/h2&gt;
&lt;p&gt;Looking at the difference between &lt;code&gt;exp(home_baseline)&lt;/code&gt; and &lt;code&gt;exp(away_baseline)&lt;/code&gt; shows that the home advantage is realised as roughly &lt;span class=&#34;math inline&#34;&gt;\(0.5\)&lt;/span&gt; more goals for the home team.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; ms2&amp;lt;-as.matrix(m2.r2jags$BUGSoutput$sims.matrix)
&amp;gt; plotPost(exp(ms2[, &amp;quot;home_baseline&amp;quot;]) - exp(ms2[, &amp;quot;away_baseline&amp;quot;]), compVal = 0,
+     xlab = &amp;quot;Home advantage in number of goals&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/mcmc_diag_post-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;                                       mean    median      mode hdiMass
Home advantage in number of goals 0.4822046 0.4822645 0.4831489    0.95
                                     hdiLow   hdiHigh compVal pcGTcompVal
Home advantage in number of goals 0.4096975 0.5549439       0           1
                                  ROPElow ROPEhigh pcInROPE
Home advantage in number of goals      NA       NA       NA&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Comparing the DIC of the of the two models also indicates that the new model is better.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; dic_m1&amp;lt;-m1.r2jags$BUGSoutput$DIC
&amp;gt; dic_m2&amp;lt;-m2.r2jags$BUGSoutput$DIC
&amp;gt; diff_dic&amp;lt;-dic_m1 - dic_m2
&amp;gt; diff_dic
[1] 168.7556&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Finally we’ll look at the simulated results for Valencia (home team) vs Sevilla (away team) using the estimates from the new model with the first row of the graph showing the predicted outcome and the second row showing the actual data.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; plot_pred_comp2 &amp;lt;- function(home_team, away_team, ms) {
+     par(mar=c(2,2,2,2))
+     par(mfrow = c(2, 4))
+     home_baseline &amp;lt;- ms[, &amp;quot;home_baseline&amp;quot;]
+     away_baseline &amp;lt;- ms[, &amp;quot;away_baseline&amp;quot;]
+     home_skill &amp;lt;- ms[, col_name(&amp;quot;skill&amp;quot;, which(teams == home_team))]
+     away_skill &amp;lt;- ms[, col_name(&amp;quot;skill&amp;quot;, which(teams == away_team))]
+     home_goals &amp;lt;- rpois(nrow(ms), exp(home_baseline + home_skill - away_skill))
+     away_goals &amp;lt;- rpois(nrow(ms), exp(away_baseline + away_skill - home_skill))
+     plot_goals(home_goals, away_goals)
+     home_goals &amp;lt;- d$HomeGoals[d$HomeTeam == home_team &amp;amp; d$AwayTeam == away_team]
+     away_goals &amp;lt;- d$AwayGoals[d$HomeTeam == home_team &amp;amp; d$AwayTeam == away_team]
+     plot_goals(home_goals, away_goals)
+ }
&amp;gt; 
&amp;gt; plot_pred_comp2(&amp;quot;FC Valencia&amp;quot;, &amp;quot;FC Sevilla&amp;quot;, ms2)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/mcmc_diag_post3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;And similarly Sevilla (home team) vs Valencia (away team).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; plot_pred_comp2(&amp;quot;FC Sevilla&amp;quot;, &amp;quot;FC Valencia&amp;quot;, ms2)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/mcmc_diag_post4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Now the results are closer to the historical data as both Sevilla and Valencia are more likely to win when playing as the home team. At this point in the modeling process I decided to try to split the skill parameter into two components, offence skill and defense skill, thinking that some teams might be good at scoring goals but at the same time be bad at keeping the opponent from scoring. This didn’t seem to result in any better fit however, perhaps because the offensive and defensive skill of a team tend to be highly related. There is however one more thing I would like to change with the model.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;allowing-for-skill-variation-over-the-season&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Allowing for skill variation over the season&lt;/h1&gt;
&lt;p&gt;The data set &lt;code&gt;laliga&lt;/code&gt; contains data from five different seasons and an assumption of the current model is that a team has the same skill during all seasons. This is probably not a realistic assumption, teams probably differ in their year-to-year performance. And what more, some teams do not even participate in all seasons in the &lt;code&gt;laliga&lt;/code&gt; data set, as a result of dropping out of the first division, as the following diagram shows:&lt;/p&gt;
&lt;div id=&#34;data-check-1&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Data check&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; qplot(Season, HomeTeam, data = d, ylab = &amp;quot;Team&amp;quot;, xlab = &amp;quot;Particicipation by Season&amp;quot;) + theme_classic()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/data_check_m3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The second iteration of the model was therefore modified to include the year-to-year variability in team skill. This was done by allowing each team to have one skill parameter per season but to connect the skill parameters by using a team’s skill parameter for season &lt;span class=&#34;math inline&#34;&gt;\(t\)&lt;/span&gt; in the prior distribution for that team’s skill parameter for season &lt;span class=&#34;math inline&#34;&gt;\(t+1\)&lt;/span&gt; so that&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{skill}_{t+1} \sim N(\text{skill}_t,\sigma^2_{\text{season}})\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;for all different &lt;span class=&#34;math inline&#34;&gt;\(t\)&lt;/span&gt;, except the first season which is given a vague prior. Here &lt;span class=&#34;math inline&#34;&gt;\(\sigma^2_{\text{season}}\)&lt;/span&gt; is a parameter estimated using the whole data set. The home and away baselines are given the same kind of priors and below is the resulting &lt;code&gt;JAGS&lt;/code&gt; model.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; # model 3
&amp;gt; m3_string &amp;lt;- &amp;quot;model {
+ for(i in 1:n_games) {
+   HomeGoals[i] ~ dpois(lambda_home[Season[i], HomeTeam[i],AwayTeam[i]])
+   AwayGoals[i] ~ dpois(lambda_away[Season[i], HomeTeam[i],AwayTeam[i]])
+ }
+ 
+ for(season_i in 1:n_seasons) {
+   for(home_i in 1:n_teams) {
+     for(away_i in 1:n_teams) {
+       lambda_home[season_i, home_i, away_i] &amp;lt;- exp( home_baseline[season_i] + skill[season_i, home_i] - skill[season_i, away_i])
+       lambda_away[season_i, home_i, away_i] &amp;lt;- exp( away_baseline[season_i] + skill[season_i, away_i] - skill[season_i, home_i])
+     }
+   }
+ }
+ 
+ skill[1, 1] &amp;lt;- 0 
+ for(j in 2:n_teams) {
+   skill[1, j] ~ dnorm(group_skill, group_tau)
+ }
+ 
+ group_skill ~ dnorm(0, 0.0625)
+ group_tau &amp;lt;- 1/pow(group_sigma, 2)
+ group_sigma ~ dunif(0, 3)
+ 
+ home_baseline[1] ~ dnorm(0, 0.0625)
+ away_baseline[1] ~ dnorm(0, 0.0625)
+ 
+ for(season_i in 2:n_seasons) {
+   skill[season_i, 1] &amp;lt;- 0 
+   for(j in 2:n_teams) {
+     skill[season_i, j] ~ dnorm(skill[season_i - 1, j], season_tau)
+   }
+   home_baseline[season_i] ~ dnorm(home_baseline[season_i - 1], season_tau)
+   away_baseline[season_i] ~ dnorm(away_baseline[season_i - 1], season_tau)
+ }
+ 
+ season_tau &amp;lt;- 1/pow(season_sigma, 2) 
+ season_sigma ~ dunif(0, 3) 
+ }
+ &amp;quot;
&amp;gt; 
&amp;gt; ## write the model to a text file
&amp;gt; writeLines(m3_string, con = &amp;quot;model3.txt&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And now re-fit the model. These changes to the model unfortunately introduce quite a lot of autocorrelation when running the MCMC sampler. Also, I re-define the data list to include information for the season parameters.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; data_list_m3 &amp;lt;- list(HomeGoals = d$HomeGoals, AwayGoals = d$AwayGoals, HomeTeam = as.numeric(factor(d$HomeTeam,
+     levels = teams)), AwayTeam = as.numeric(factor(d$AwayTeam, levels = teams)),
+     Season = as.numeric(factor(d$Season, levels = seasons)), n_teams = length(teams),
+     n_games = nrow(d), n_seasons = length(seasons))
&amp;gt; params &amp;lt;- c(&amp;quot;home_baseline&amp;quot;, &amp;quot;away_baseline&amp;quot;, &amp;quot;skill&amp;quot;, &amp;quot;season_sigma&amp;quot;, &amp;quot;group_sigma&amp;quot;, &amp;quot;group_skill&amp;quot;)
&amp;gt; nChains = 2
&amp;gt; burnInSteps = 3000
&amp;gt; thinSteps = 1
&amp;gt; numSavedSteps = 15000  #across all chains
&amp;gt; nIter = ceiling(burnInSteps + (numSavedSteps * thinSteps)/nChains)
&amp;gt; 
&amp;gt; m3.r2jags &amp;lt;- jags(data = data_list_m3, inits = NULL, parameters.to.save = params,
+     model.file = &amp;quot;model3.txt&amp;quot;, n.chains = nChains, n.iter = nIter,
+     n.burnin = burnInSteps, n.thin = thinSteps)
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 3700
   Unobserved stochastic nodes: 153
   Total graph size: 26525

Initializing model
&amp;gt; 
&amp;gt; print(m3.r2jags)
Inference for Bugs model at &amp;quot;model3.txt&amp;quot;, fit using jags,
 2 chains, each with 10500 iterations (first 3000 discarded)
 n.sims = 15000 iterations saved
                   mu.vect sd.vect      2.5%       25%       50%       75%
away_baseline[1]     0.105   0.038     0.030     0.079     0.103     0.130
away_baseline[2]     0.078   0.030     0.018     0.059     0.079     0.099
away_baseline[3]     0.067   0.031     0.005     0.047     0.069     0.089
away_baseline[4]     0.064   0.032    -0.001     0.043     0.065     0.087
away_baseline[5]     0.079   0.035     0.011     0.056     0.080     0.101
group_sigma          0.217   0.035     0.158     0.193     0.214     0.238
group_skill          0.018   0.060    -0.090    -0.023     0.015     0.057
home_baseline[1]     0.447   0.029     0.392     0.428     0.446     0.466
home_baseline[2]     0.437   0.026     0.383     0.421     0.438     0.454
home_baseline[3]     0.443   0.026     0.389     0.427     0.443     0.459
home_baseline[4]     0.452   0.027     0.400     0.434     0.451     0.469
home_baseline[5]     0.454   0.031     0.394     0.434     0.452     0.474
season_sigma         0.033   0.019     0.001     0.016     0.032     0.048
skill[1,1]           0.000   0.000     0.000     0.000     0.000     0.000
skill[2,1]           0.000   0.000     0.000     0.000     0.000     0.000
skill[3,1]           0.000   0.000     0.000     0.000     0.000     0.000
skill[4,1]           0.000   0.000     0.000     0.000     0.000     0.000
skill[5,1]           0.000   0.000     0.000     0.000     0.000     0.000
skill[1,2]           0.178   0.067     0.047     0.136     0.175     0.218
skill[2,2]           0.169   0.065     0.039     0.129     0.167     0.207
skill[3,2]           0.181   0.064     0.061     0.139     0.177     0.219
skill[4,2]           0.195   0.065     0.076     0.148     0.189     0.235
skill[5,2]           0.216   0.075     0.090     0.161     0.209     0.265
skill[1,3]           0.015   0.074    -0.126    -0.033     0.013     0.060
skill[2,3]           0.017   0.075    -0.127    -0.030     0.014     0.063
skill[3,3]           0.020   0.074    -0.121    -0.027     0.017     0.066
skill[4,3]           0.022   0.071    -0.111    -0.024     0.018     0.066
skill[5,3]           0.027   0.075    -0.111    -0.021     0.023     0.074
skill[1,4]          -0.008   0.066    -0.122    -0.053    -0.012     0.035
skill[2,4]          -0.011   0.063    -0.118    -0.053    -0.015     0.031
skill[3,4]          -0.010   0.063    -0.120    -0.052    -0.015     0.031
skill[4,4]          -0.020   0.065    -0.136    -0.064    -0.024     0.022
skill[5,4]          -0.022   0.069    -0.151    -0.069    -0.025     0.023
skill[1,5]          -0.174   0.098    -0.370    -0.238    -0.173    -0.107
skill[2,5]          -0.174   0.104    -0.384    -0.242    -0.174    -0.104
skill[3,5]          -0.174   0.111    -0.394    -0.247    -0.174    -0.102
skill[4,5]          -0.174   0.117    -0.408    -0.251    -0.174    -0.098
skill[5,5]          -0.174   0.123    -0.420    -0.254    -0.175    -0.095
skill[1,6]          -0.034   0.074    -0.161    -0.085    -0.039     0.017
skill[2,6]          -0.048   0.068    -0.167    -0.096    -0.052    -0.004
skill[3,6]          -0.058   0.067    -0.176    -0.106    -0.060    -0.015
skill[4,6]          -0.065   0.072    -0.193    -0.117    -0.067    -0.019
skill[5,6]          -0.071   0.075    -0.207    -0.125    -0.072    -0.025
skill[1,7]          -0.006   0.069    -0.124    -0.054    -0.013     0.038
skill[2,7]          -0.014   0.065    -0.129    -0.058    -0.021     0.027
skill[3,7]          -0.009   0.064    -0.120    -0.054    -0.016     0.031
skill[4,7]          -0.006   0.066    -0.117    -0.052    -0.013     0.035
skill[5,7]          -0.001   0.071    -0.122    -0.051    -0.009     0.044
skill[1,8]           0.200   0.067     0.069     0.155     0.198     0.242
skill[2,8]           0.206   0.063     0.086     0.162     0.203     0.246
skill[3,8]           0.209   0.063     0.090     0.164     0.206     0.250
skill[4,8]           0.204   0.064     0.082     0.158     0.202     0.244
skill[5,8]           0.195   0.069     0.059     0.151     0.194     0.239
skill[1,9]          -0.055   0.073    -0.193    -0.102    -0.057    -0.005
skill[2,9]          -0.074   0.068    -0.203    -0.119    -0.077    -0.026
skill[3,9]          -0.087   0.068    -0.219    -0.133    -0.088    -0.040
skill[4,9]          -0.105   0.074    -0.254    -0.155    -0.101    -0.057
skill[5,9]          -0.105   0.083    -0.279    -0.159    -0.100    -0.049
skill[1,10]         -0.121   0.072    -0.246    -0.175    -0.125    -0.072
skill[2,10]         -0.109   0.070    -0.224    -0.163    -0.113    -0.061
skill[3,10]         -0.102   0.071    -0.219    -0.156    -0.106    -0.051
skill[4,10]         -0.111   0.073    -0.234    -0.168    -0.116    -0.060
skill[5,10]         -0.111   0.083    -0.259    -0.173    -0.116    -0.055
skill[1,11]          0.676   0.072     0.526     0.629     0.680     0.726
skill[2,11]          0.696   0.063     0.571     0.654     0.699     0.738
skill[3,11]          0.712   0.060     0.600     0.672     0.712     0.750
skill[4,11]          0.728   0.061     0.617     0.688     0.725     0.761
skill[5,11]          0.727   0.064     0.606     0.686     0.725     0.763
skill[1,12]          0.146   0.064     0.025     0.106     0.144     0.186
skill[2,12]          0.143   0.060     0.028     0.105     0.141     0.180
skill[3,12]          0.131   0.058     0.019     0.094     0.130     0.168
skill[4,12]          0.127   0.059     0.010     0.089     0.126     0.164
skill[5,12]          0.127   0.064     0.002     0.086     0.126     0.166
skill[1,13]          0.031   0.065    -0.087    -0.014     0.028     0.071
skill[2,13]          0.035   0.062    -0.077    -0.008     0.032     0.073
skill[3,13]          0.023   0.061    -0.091    -0.019     0.020     0.062
skill[4,13]          0.017   0.062    -0.101    -0.026     0.015     0.057
skill[5,13]          0.015   0.067    -0.117    -0.030     0.014     0.057
skill[1,14]          0.028   0.064    -0.095    -0.015     0.025     0.069
skill[2,14]          0.027   0.061    -0.091    -0.014     0.024     0.065
skill[3,14]          0.030   0.059    -0.085    -0.010     0.027     0.067
skill[4,14]          0.046   0.062    -0.067     0.004     0.040     0.085
skill[5,14]          0.055   0.068    -0.064     0.008     0.049     0.099
skill[1,15]          0.015   0.065    -0.106    -0.029     0.009     0.055
skill[2,15]          0.019   0.063    -0.095    -0.024     0.012     0.058
skill[3,15]         -0.003   0.061    -0.115    -0.043    -0.005     0.034
skill[4,15]         -0.014   0.062    -0.132    -0.055    -0.015     0.024
skill[5,15]         -0.037   0.071    -0.182    -0.082    -0.034     0.009
skill[1,16]         -0.120   0.096    -0.304    -0.187    -0.122    -0.055
skill[2,16]         -0.121   0.103    -0.319    -0.192    -0.122    -0.051
skill[3,16]         -0.121   0.109    -0.329    -0.195    -0.121    -0.047
skill[4,16]         -0.121   0.116    -0.342    -0.197    -0.122    -0.044
skill[5,16]         -0.120   0.121    -0.357    -0.201    -0.121    -0.041
skill[1,17]          0.543   0.083     0.372     0.491     0.544     0.600
skill[2,17]          0.588   0.067     0.470     0.541     0.586     0.631
skill[3,17]          0.621   0.068     0.495     0.575     0.617     0.666
skill[4,17]          0.646   0.075     0.501     0.593     0.644     0.697
skill[5,17]          0.640   0.077     0.497     0.586     0.637     0.694
skill[1,18]         -0.068   0.075    -0.209    -0.122    -0.069    -0.021
skill[2,18]         -0.075   0.074    -0.219    -0.126    -0.075    -0.029
skill[3,18]         -0.068   0.078    -0.218    -0.122    -0.067    -0.019
skill[4,18]         -0.061   0.081    -0.217    -0.117    -0.060    -0.011
skill[5,18]         -0.054   0.081    -0.208    -0.110    -0.054    -0.002
skill[1,19]         -0.099   0.066    -0.220    -0.144    -0.101    -0.057
skill[2,19]         -0.106   0.065    -0.227    -0.151    -0.108    -0.064
skill[3,19]         -0.122   0.070    -0.260    -0.170    -0.121    -0.074
skill[4,19]         -0.122   0.080    -0.290    -0.174    -0.119    -0.069
skill[5,19]         -0.122   0.089    -0.312    -0.176    -0.118    -0.065
skill[1,20]          0.086   0.068    -0.034     0.038     0.083     0.130
skill[2,20]          0.083   0.065    -0.031     0.036     0.079     0.126
skill[3,20]          0.082   0.065    -0.033     0.034     0.078     0.125
skill[4,20]          0.065   0.070    -0.068     0.017     0.063     0.110
skill[5,20]          0.065   0.079    -0.094     0.014     0.064     0.115
skill[1,21]         -0.097   0.081    -0.245    -0.154    -0.103    -0.042
skill[2,21]         -0.101   0.073    -0.234    -0.152    -0.104    -0.048
skill[3,21]         -0.100   0.071    -0.230    -0.149    -0.103    -0.050
skill[4,21]         -0.107   0.070    -0.237    -0.155    -0.110    -0.059
skill[5,21]         -0.108   0.074    -0.245    -0.158    -0.114    -0.058
skill[1,22]         -0.197   0.106    -0.391    -0.269    -0.198    -0.126
skill[2,22]         -0.204   0.100    -0.389    -0.272    -0.205    -0.138
skill[3,22]         -0.204   0.107    -0.401    -0.278    -0.204    -0.134
skill[4,22]         -0.205   0.114    -0.418    -0.282    -0.205    -0.131
skill[5,22]         -0.205   0.120    -0.432    -0.287    -0.206    -0.127
skill[1,23]         -0.158   0.099    -0.343    -0.228    -0.160    -0.092
skill[2,23]         -0.164   0.094    -0.340    -0.232    -0.165    -0.102
skill[3,23]         -0.163   0.102    -0.357    -0.235    -0.165    -0.097
skill[4,23]         -0.164   0.108    -0.373    -0.239    -0.165    -0.094
skill[5,23]         -0.164   0.114    -0.386    -0.241    -0.165    -0.092
skill[1,24]         -0.102   0.105    -0.310    -0.171    -0.105    -0.033
skill[2,24]         -0.107   0.102    -0.306    -0.174    -0.108    -0.041
skill[3,24]         -0.112   0.097    -0.301    -0.177    -0.112    -0.049
skill[4,24]         -0.112   0.104    -0.317    -0.181    -0.113    -0.044
skill[5,24]         -0.112   0.111    -0.329    -0.185    -0.112    -0.041
skill[1,25]          0.009   0.086    -0.149    -0.046     0.007     0.066
skill[2,25]          0.009   0.081    -0.145    -0.044     0.006     0.061
skill[3,25]          0.008   0.074    -0.140    -0.042     0.006     0.055
skill[4,25]          0.013   0.074    -0.139    -0.038     0.011     0.060
skill[5,25]          0.003   0.077    -0.143    -0.047     0.001     0.053
skill[1,26]          0.048   0.088    -0.117    -0.019     0.046     0.108
skill[2,26]          0.049   0.083    -0.104    -0.013     0.047     0.104
skill[3,26]          0.049   0.076    -0.083    -0.009     0.047     0.099
skill[4,26]          0.068   0.075    -0.063     0.014     0.066     0.118
skill[5,26]          0.091   0.082    -0.057     0.034     0.091     0.145
skill[1,27]         -0.051   0.093    -0.236    -0.108    -0.049     0.000
skill[2,27]         -0.054   0.088    -0.231    -0.108    -0.050    -0.003
skill[3,27]         -0.055   0.084    -0.224    -0.108    -0.052    -0.006
skill[4,27]         -0.057   0.077    -0.213    -0.107    -0.054    -0.012
skill[5,27]         -0.053   0.079    -0.211    -0.104    -0.051    -0.007
skill[1,28]         -0.110   0.099    -0.292    -0.188    -0.112    -0.039
skill[2,28]         -0.113   0.094    -0.288    -0.188    -0.115    -0.046
skill[3,28]         -0.117   0.088    -0.282    -0.186    -0.120    -0.052
skill[4,28]         -0.121   0.081    -0.274    -0.186    -0.123    -0.063
skill[5,28]         -0.124   0.082    -0.278    -0.188    -0.127    -0.066
skill[1,29]         -0.057   0.129    -0.272    -0.154    -0.066     0.028
skill[2,29]         -0.059   0.127    -0.270    -0.155    -0.067     0.022
skill[3,29]         -0.061   0.124    -0.268    -0.154    -0.068     0.019
skill[4,29]         -0.062   0.121    -0.268    -0.152    -0.069     0.014
skill[5,29]         -0.063   0.117    -0.267    -0.149    -0.068     0.010
deviance         10731.636  11.981 10708.084 10723.239 10732.002 10740.556
                     97.5%  Rhat n.eff
away_baseline[1]     0.185 1.056    34
away_baseline[2]     0.135 1.004   500
away_baseline[3]     0.123 1.001  7800
away_baseline[4]     0.121 1.001  3300
away_baseline[5]     0.148 1.006   280
group_sigma          0.297 1.008   210
group_skill          0.146 1.015  5000
home_baseline[1]     0.508 1.018   260
home_baseline[2]     0.487 1.005 15000
home_baseline[3]     0.493 1.004 15000
home_baseline[4]     0.506 1.007   390
home_baseline[5]     0.516 1.011   260
season_sigma         0.069 1.323    11
skill[1,1]           0.000 1.000     1
skill[2,1]           0.000 1.000     1
skill[3,1]           0.000 1.000     1
skill[4,1]           0.000 1.000     1
skill[5,1]           0.000 1.000     1
skill[1,2]           0.323 1.003  5900
skill[2,2]           0.315 1.003 15000
skill[3,2]           0.323 1.008   880
skill[4,2]           0.338 1.012   290
skill[5,2]           0.377 1.016   130
skill[1,3]           0.170 1.017   110
skill[2,3]           0.174 1.014   150
skill[3,3]           0.175 1.013   180
skill[4,3]           0.173 1.011   250
skill[5,3]           0.185 1.004   470
skill[1,4]           0.130 1.005   510
skill[2,4]           0.121 1.004   680
skill[3,4]           0.123 1.006   380
skill[4,4]           0.117 1.003   820
skill[5,4]           0.121 1.002  1200
skill[1,5]           0.015 1.002  1400
skill[2,5]           0.033 1.002  1500
skill[3,5]           0.046 1.002  1800
skill[4,5]           0.060 1.002  2000
skill[5,5]           0.074 1.002  1900
skill[1,6]           0.116 1.008   620
skill[2,6]           0.092 1.010 15000
skill[3,6]           0.084 1.012  3500
skill[4,6]           0.085 1.011  1200
skill[5,6]           0.086 1.012   710
skill[1,7]           0.145 1.005 11000
skill[2,7]           0.133 1.011 15000
skill[3,7]           0.134 1.015 15000
skill[4,7]           0.142 1.012 15000
skill[5,7]           0.154 1.007 15000
skill[1,8]           0.337 1.001 15000
skill[2,8]           0.339 1.003 15000
skill[3,8]           0.341 1.001  6700
skill[4,8]           0.340 1.003 15000
skill[5,8]           0.338 1.003  1400
skill[1,9]           0.090 1.019   140
skill[2,9]           0.059 1.010   520
skill[3,9]           0.046 1.007 13000
skill[4,9]           0.035 1.004   790
skill[5,9]           0.047 1.003   790
skill[1,10]          0.027 1.011   150
skill[2,10]          0.032 1.016   110
skill[3,10]          0.040 1.021    98
skill[4,10]          0.037 1.011   170
skill[5,10]          0.057 1.008   200
skill[1,11]          0.815 1.035    59
skill[2,11]          0.825 1.019   110
skill[3,11]          0.839 1.006   320
skill[4,11]          0.860 1.002  1100
skill[5,11]          0.866 1.002  1000
skill[1,12]          0.279 1.002  1900
skill[2,12]          0.267 1.002  1300
skill[3,12]          0.247 1.009   300
skill[4,12]          0.244 1.012   190
skill[5,12]          0.255 1.006   280
skill[1,13]          0.168 1.002  4300
skill[2,13]          0.167 1.004 15000
skill[3,13]          0.153 1.009   350
skill[4,13]          0.148 1.014   170
skill[5,13]          0.152 1.012   210
skill[1,14]          0.159 1.007   240
skill[2,14]          0.153 1.007   240
skill[3,14]          0.156 1.006   410
skill[4,14]          0.176 1.001 15000
skill[5,14]          0.202 1.002  1400
skill[1,15]          0.155 1.001  4000
skill[2,15]          0.154 1.001  4000
skill[3,15]          0.122 1.008   210
skill[4,15]          0.113 1.013   130
skill[5,15]          0.100 1.030    58
skill[1,16]          0.071 1.004   970
skill[2,16]          0.084 1.002  1200
skill[3,16]          0.095 1.002  1000
skill[4,16]          0.108 1.002   970
skill[5,16]          0.121 1.002  1000
skill[1,17]          0.704 1.009   190
skill[2,17]          0.721 1.002 15000
skill[3,17]          0.759 1.023   100
skill[4,17]          0.800 1.049    48
skill[5,17]          0.796 1.039    58
skill[1,18]          0.086 1.011   160
skill[2,18]          0.077 1.008   220
skill[3,18]          0.089 1.010   170
skill[4,18]          0.099 1.011   160
skill[5,18]          0.108 1.014   120
skill[1,19]          0.039 1.013   130
skill[2,19]          0.028 1.016   100
skill[3,19]          0.017 1.028    62
skill[4,19]          0.036 1.020    83
skill[5,19]          0.054 1.017    98
skill[1,20]          0.229 1.006   280
skill[2,20]          0.221 1.006   300
skill[3,20]          0.220 1.004   510
skill[4,20]          0.207 1.001 15000
skill[5,20]          0.223 1.001 15000
skill[1,21]          0.063 1.006   320
skill[2,21]          0.043 1.005   390
skill[3,21]          0.042 1.007   240
skill[4,21]          0.037 1.007   250
skill[5,21]          0.044 1.009   190
skill[1,22]          0.014 1.011   150
skill[2,22]         -0.001 1.012   160
skill[3,22]          0.010 1.010   180
skill[4,22]          0.026 1.008   220
skill[5,22]          0.038 1.006   270
skill[1,23]          0.043 1.003   710
skill[2,23]          0.026 1.002  1200
skill[3,23]          0.042 1.002  1900
skill[4,23]          0.054 1.001  2600
skill[5,23]          0.070 1.002  2300
skill[1,24]          0.109 1.001 15000
skill[2,24]          0.096 1.001  5000
skill[3,24]          0.085 1.001  2700
skill[4,24]          0.098 1.001  3600
skill[5,24]          0.109 1.002  3300
skill[1,25]          0.186 1.021   480
skill[2,25]          0.174 1.030   410
skill[3,25]          0.163 1.041   410
skill[4,25]          0.169 1.041   230
skill[5,25]          0.162 1.023   310
skill[1,26]          0.228 1.010   240
skill[2,26]          0.220 1.015   170
skill[3,26]          0.203 1.026   120
skill[4,26]          0.224 1.052    49
skill[5,26]          0.257 1.078    31
skill[1,27]          0.143 1.001  3900
skill[2,27]          0.129 1.001  9900
skill[3,27]          0.118 1.001 15000
skill[4,27]          0.103 1.002  1600
skill[5,27]          0.112 1.001  3800
skill[1,28]          0.087 1.003   720
skill[2,28]          0.068 1.004   470
skill[3,28]          0.052 1.006   310
skill[4,28]          0.035 1.009   190
skill[5,28]          0.035 1.012   140
skill[1,29]          0.235 1.058   160
skill[2,29]          0.230 1.061   160
skill[3,29]          0.224 1.068   150
skill[4,29]          0.215 1.076   130
skill[5,29]          0.204 1.085   110
deviance         10752.921 1.060    31

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = var(deviance)/2)
pD = 69.4 and DIC = 10801.0
DIC is an estimate of expected predictive error (lower deviance is better).&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;mcmc-diagnostics-2&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;MCMC diagnostics&lt;/h2&gt;
&lt;p&gt;The following graph shows the trace plot and distribution of the &lt;code&gt;season_sigma&lt;/code&gt; parameter.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; denplot(m3.r2jags, parms = &amp;quot;season_sigma&amp;quot;, style = &amp;quot;plain&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/mcmc_diag_m3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; traplot(m3.r2jags, parms = &amp;quot;season_sigma&amp;quot;, style = &amp;quot;plain&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/mcmc_diag_m3-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Calculating and comparing the DIC of this model with the former model show no substantial difference.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; dic_m2&amp;lt;-m2.r2jags$BUGSoutput$DIC
&amp;gt; dic_m3&amp;lt;-m3.r2jags$BUGSoutput$DIC
&amp;gt; diff_dic&amp;lt;-dic_m2 - dic_m3
&amp;gt; diff_dic
[1] -29.50679&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However, I believe the assumptions of the current model (m3) are more reasonable so I’ll stick with this model.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;ranking-the-teams-of-la-liga&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Ranking the teams of La Liga&lt;/h1&gt;
&lt;p&gt;We’ll start by ranking the teams of La Liga using the estimated skill parameters from the 2012/2013 season. The values of the skill parameters are difficult to interpret as they are relative to the skill of the team that had its skill parameter “anchored” at zero. To put them on a more interpretable scale I’ll first zero center the skill parameters by subtracting the mean skill of all teams, I then add the home baseline and exponentiate the resulting values. These rescaled skill parameters are now on the scale of expected number of goals when playing home team. Below is a caterpillar plot of the median of the rescaled skill parameters together with the &lt;span class=&#34;math inline&#34;&gt;\(68\)&lt;/span&gt;% and &lt;span class=&#34;math inline&#34;&gt;\(95\)&lt;/span&gt;% credible intervals. The plot is ordered according to the median skill and thus also gives the ranking of the teams.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; # The ranking of the teams for the 2012/13 season.
&amp;gt; ms3&amp;lt;-m3.r2jags$BUGSoutput$sims.matrix
&amp;gt; team_skill &amp;lt;- ms3[, str_detect(string = colnames(ms3), &amp;quot;skill\\[5,&amp;quot;)]
&amp;gt; team_skill &amp;lt;- (team_skill - rowMeans(team_skill)) + ms3[, &amp;quot;home_baseline[5]&amp;quot;]
&amp;gt; team_skill &amp;lt;- exp(team_skill)
&amp;gt; colnames(team_skill) &amp;lt;- teams
&amp;gt; team_skill &amp;lt;- team_skill[, order(colMeans(team_skill), decreasing = T)]
&amp;gt; par(mar = c(2, 0.7, 0.7, 0.7), xaxs = &amp;quot;i&amp;quot;)
&amp;gt; caterplot(team_skill, labels.loc = &amp;quot;above&amp;quot;, val.lim = c(0.7, 3.8), style = &amp;quot;plain&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/cat_plot-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Two teams are clearly ahead of the rest, FC Barcelona and Real Madrid CF. Let’s look at the credible difference between the two teams.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; plotPost(team_skill[, &amp;quot;FC Barcelona&amp;quot;] - team_skill[, &amp;quot;Real Madrid CF&amp;quot;], compVal = 0,
+     xlab = &amp;quot;← Real Madrid     vs     Barcelona →&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/cat_plot2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;                                                      mean    median      mode
&amp;lt;U+2190&amp;gt; Real Madrid     vs     Barcelona &amp;lt;U+2192&amp;gt; 0.26639 0.2657129 0.2950102
                                                   hdiMass     hdiLow  hdiHigh
&amp;lt;U+2190&amp;gt; Real Madrid     vs     Barcelona &amp;lt;U+2192&amp;gt;    0.95 -0.1863186 0.785901
                                                   compVal pcGTcompVal ROPElow
&amp;lt;U+2190&amp;gt; Real Madrid     vs     Barcelona &amp;lt;U+2192&amp;gt;       0   0.8660667      NA
                                                   ROPEhigh pcInROPE
&amp;lt;U+2190&amp;gt; Real Madrid     vs     Barcelona &amp;lt;U+2192&amp;gt;       NA       NA&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;FC Barcelona is the better team with a probability of &lt;span class=&#34;math inline&#34;&gt;\(82\)&lt;/span&gt;%&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;predicting-the-end-game-of-la-liga-20122013&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Predicting the End Game of La Liga 2012/2013&lt;/h1&gt;
&lt;p&gt;In the laliga data set the results of the &lt;span class=&#34;math inline&#34;&gt;\(50\)&lt;/span&gt; last games of the 2012/2013 season was missing. Using our model we can now both predict and simulate the outcomes of these &lt;span class=&#34;math inline&#34;&gt;\(50\)&lt;/span&gt; games. The R code below calculates a number of measures for each game (both the games with known and unknown outcomes):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;The mode of the simulated number of goals, that is, the most likely number of scored goals. If we were asked to bet on the number of goals in a game this is what we would use.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The mean of the simulated number of goals, this is our best guess of the average number of goals in a game.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The most likely match result for each game.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;A random sample from the distributions of credible home scores, away scores and match results. This is how La Liga actually could have played out in an alternative reality.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; n &amp;lt;- nrow(ms3)
&amp;gt; m3_pred &amp;lt;- sapply(1:nrow(laliga), function(i) {
+   home_team &amp;lt;- which(teams == laliga$HomeTeam[i])
+   away_team &amp;lt;- which(teams == laliga$AwayTeam[i])
+   season &amp;lt;- which(seasons == laliga$Season[i])
+   home_skill &amp;lt;- ms3[, col_name(&amp;quot;skill&amp;quot;, season, home_team)]
+   away_skill &amp;lt;- ms3[, col_name(&amp;quot;skill&amp;quot;, season, away_team)]
+   home_baseline &amp;lt;- ms3[, col_name(&amp;quot;home_baseline&amp;quot;, season)]
+   away_baseline &amp;lt;- ms3[, col_name(&amp;quot;away_baseline&amp;quot;, season)]
+ 
+   home_goals &amp;lt;- rpois(n, exp(home_baseline + home_skill - away_skill))
+   away_goals &amp;lt;- rpois(n, exp(away_baseline + away_skill - home_skill))
+   home_goals_table &amp;lt;- table(home_goals)
+   away_goals_table &amp;lt;- table(away_goals)
+   match_results &amp;lt;- sign(home_goals - away_goals)
+   match_results_table &amp;lt;- table(match_results)
+ 
+   mode_home_goal &amp;lt;- as.numeric(names(home_goals_table)[ which.max(home_goals_table)])
+   mode_away_goal &amp;lt;- as.numeric(names(away_goals_table)[ which.max(away_goals_table)])
+   match_result &amp;lt;-  as.numeric(names(match_results_table)[which.max(match_results_table)])
+   rand_i &amp;lt;- sample(seq_along(home_goals), 1)
+ 
+   c(mode_home_goal = mode_home_goal, mode_away_goal = mode_away_goal, match_result = match_result,
+     mean_home_goal = mean(home_goals), mean_away_goal = mean(away_goals),
+     rand_home_goal = home_goals[rand_i], rand_away_goal = away_goals[rand_i],
+     rand_match_result = match_results[rand_i])
+ })
&amp;gt; m3_pred &amp;lt;- t(m3_pred)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;First let’s compare the distribution of the number of goals in the data with the predicted mode, mean and randomised number of goals for all the games (focusing on the number of goals for the home team). First the actual distribution of the number of goals for the home teams.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; hist(laliga$HomeGoals, breaks = (-1:10) + 0.5, xlim = c(-0.5, 10), main = &amp;quot;Distribution of the number of goals\nscored by a home team in a match.&amp;quot;, xlab = &amp;quot;&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/pred1_m3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;This next plot shows the distribution of the modes from the predicted distribution of home goals from each game. That is, what is the most probable outcome, for the home team, in each game.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; hist(m3_pred[, &amp;quot;mode_home_goal&amp;quot;], breaks = (-1:10) + 0.5, xlim = c(-0.5, 10),
+     main = &amp;quot;Distribution of predicted most\nprobable scoreby a home team in\na match.&amp;quot;, xlab = &amp;quot;&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/pred2_m3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;For almost all games the single most likely number of goals is one. Actually, if you know nothing about a La Liga game betting on one goal for the home team is &lt;span class=&#34;math inline&#34;&gt;\(78\)&lt;/span&gt;% of the times the best bet. Lest instead look at the distribution of the predicted mean number of home goals in each game.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; hist(m3_pred[, &amp;quot;mean_home_goal&amp;quot;], breaks = (-1:10) + 0.5, xlim = c(-0.5, 10),
+     main = &amp;quot;Distribution of predicted mean \n score by a home team in a match.&amp;quot;, xlab = &amp;quot;&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/pred3_m3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;For most games the expected number of goals are &lt;span class=&#34;math inline&#34;&gt;\(2\)&lt;/span&gt;. That is, even if your safest bet is one goal you would expect to see around two goals. The distribution of the mode and the mean number of goals doesn’t look remotely like the actual number of goals. This was not to be expected, we would however expect the distribution of randomized goals (where for each match the number of goals has been randomly drawn from that match’s predicted home goal distribution) to look similar to the actual number of home goals. Looking at the histogram below, this seems to be the case.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; hist(m3_pred[, &amp;quot;rand_home_goal&amp;quot;], breaks = (-1:10) + 0.5, xlim = c(-0.5, 10),
+     main = &amp;quot;Distribution of randomly draw \n score by a home team in a match.&amp;quot;, xlab = &amp;quot;&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/pred4_m3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We can also look at how well the model predicts the data. This should probably be done using cross validation, but as the number of effective parameters are much smaller than the number of data points a direct comparison should at least give an estimated prediction accuracy in the right ballpark.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; mean(laliga$HomeGoals == m3_pred[, &amp;quot;mode_home_goal&amp;quot;], na.rm = T)
[1] 0.3318919
&amp;gt; 
&amp;gt; mean((laliga$HomeGoals - m3_pred[, &amp;quot;mean_home_goal&amp;quot;])^2, na.rm = T)
[1] 1.457061&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So on average the model predicts the correct number of home goals &lt;span class=&#34;math inline&#34;&gt;\(34\)&lt;/span&gt;% of the time and guesses the average number of goals with a mean squared error of &lt;span class=&#34;math inline&#34;&gt;\(1.45\)&lt;/span&gt;. Now we’ll look at the actual and predicted match outcomes. The graph below shows the match outcomes in the data with &lt;span class=&#34;math inline&#34;&gt;\(1\)&lt;/span&gt; being a home win, &lt;span class=&#34;math inline&#34;&gt;\(0\)&lt;/span&gt; being a draw and &lt;span class=&#34;math inline&#34;&gt;\(-1\)&lt;/span&gt; being a win for the away team.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; hist(laliga$MatchResult, breaks = (-2:1) + 0.5, main = &amp;quot;Actual match results.&amp;quot;, xlab = &amp;quot;&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/pred6_m3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Now looking at the most probable outcomes of the matches according to the model.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; hist(m3_pred[, &amp;quot;match_result&amp;quot;], breaks = (-2:1) + 0.5, main = &amp;quot;Predicted match results.&amp;quot;, xlab = &amp;quot;&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/pred7_m3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;For almost all matches the safest bet is to bet on the home team. While draws are not uncommon it is never the safest bet. As in the case with the number of home goals, the randomized match outcomes have a distribution similar to the actual match outcomes:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; hist(m3_pred[, &amp;quot;rand_match_result&amp;quot;], breaks = (-2:1) + 0.5, main = &amp;quot;Randomized match results.&amp;quot;, xlab = &amp;quot;&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/pred8_m3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; mean(laliga$MatchResult == m3_pred[, &amp;quot;match_result&amp;quot;], na.rm = T)
[1] 0.5637838&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The model predicts the correct match outcome &lt;span class=&#34;math inline&#34;&gt;\(56\)&lt;/span&gt;% of the time. Pretty good! Now that we’ve checked that the model reasonably predicts the La Liga history let’s predict the La Liga endgame! The code below displays the predicted mode and mean number of goals for the endgame and the predicted winner of each game.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; laliga_forecast &amp;lt;- laliga[is.na(laliga$HomeGoals), c(&amp;quot;Season&amp;quot;, &amp;quot;Week&amp;quot;, &amp;quot;HomeTeam&amp;quot;,
+     &amp;quot;AwayTeam&amp;quot;)]
&amp;gt; m3_forecast &amp;lt;- m3_pred[is.na(laliga$HomeGoals), ]
&amp;gt; laliga_forecast$mean_home_goals &amp;lt;- round(m3_forecast[, &amp;quot;mean_home_goal&amp;quot;], 1)
&amp;gt; laliga_forecast$mean_away_goals &amp;lt;- round(m3_forecast[, &amp;quot;mean_away_goal&amp;quot;], 1)
&amp;gt; laliga_forecast$mode_home_goals &amp;lt;- m3_forecast[, &amp;quot;mode_home_goal&amp;quot;]
&amp;gt; laliga_forecast$mode_away_goals &amp;lt;- m3_forecast[, &amp;quot;mode_away_goal&amp;quot;]
&amp;gt; laliga_forecast$predicted_winner &amp;lt;- ifelse(m3_forecast[, &amp;quot;match_result&amp;quot;] ==
+     1, laliga_forecast$HomeTeam, ifelse(m3_forecast[, &amp;quot;match_result&amp;quot;] == -1,
+     laliga_forecast$AwayTeam, &amp;quot;Draw&amp;quot;))
&amp;gt; 
&amp;gt; rownames(laliga_forecast) &amp;lt;- NULL
&amp;gt; knitr::kable(laliga_forecast, &amp;quot;pandoc&amp;quot;, align = &amp;quot;c&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;center&#34;&gt;Season&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Week&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;HomeTeam&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;AwayTeam&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;mean_home_goals&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;mean_away_goals&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;mode_home_goals&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;mode_away_goals&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;predicted_winner&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Espanyol Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Espanyol Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Espanyol Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Espanyol Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Espanyol Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;While these predictions are good if you want to bet on the likely winner they do not reflect how the actual endgame will play out, e.g., there is not a single draw in the predicted_winner column. So at last let’s look at a possible version of the La Liga endgame by displaying the simulated match results calculated earlier.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; laliga_sim &amp;lt;- laliga[is.na(laliga$HomeGoals), c(&amp;quot;Season&amp;quot;, &amp;quot;Week&amp;quot;, &amp;quot;HomeTeam&amp;quot;,
+     &amp;quot;AwayTeam&amp;quot;)]
&amp;gt; laliga_sim$home_goals &amp;lt;- m3_forecast[, &amp;quot;rand_home_goal&amp;quot;]
&amp;gt; laliga_sim$away_goals &amp;lt;- m3_forecast[, &amp;quot;rand_away_goal&amp;quot;]
&amp;gt; laliga_sim$winner &amp;lt;- ifelse(m3_forecast[, &amp;quot;rand_match_result&amp;quot;] == 1, laliga_forecast$HomeTeam,
+     ifelse(m3_forecast[, &amp;quot;rand_match_result&amp;quot;] == -1, laliga_forecast$AwayTeam,
+         &amp;quot;Draw&amp;quot;))
&amp;gt; 
&amp;gt; rownames(laliga_sim) &amp;lt;- NULL
&amp;gt; knitr::kable(laliga_sim, &amp;quot;pandoc&amp;quot;, align = &amp;quot;c&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;center&#34;&gt;Season&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Week&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;HomeTeam&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;AwayTeam&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;home_goals&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;away_goals&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;winner&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Draw&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Espanyol Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Espanyol Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Draw&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Espanyol Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Draw&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Draw&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Draw&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Espanyol Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Draw&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Celta Vigo&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Espanyol Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Draw&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Deportivo de La CoruÃ±a&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Sociedad San Sebastian&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MÃ¡laga CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Barcelona&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Valencia&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FC Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Granada CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Getafe CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Levante U.D.&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Betis Sevilla&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Valladolid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RCD Mallorca&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Athletic Club Bilbao&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rayo Vallecano&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CA Osasuna&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Madrid CF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;2012/13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;38&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Real Zaragoza&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AtlÃ©tico Madrid&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Now we see a number of games resulting in a draw. We also see that Malaga manages to beat Real Madrid in week &lt;span class=&#34;math inline&#34;&gt;\(36\)&lt;/span&gt;, against all odds, even though playing as the away team.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;calculating-the-predicted-payout-for-sevilla-vs-valencia-2013-06-01&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Calculating the Predicted Payout for Sevilla vs Valencia, 2013-06-01&lt;/h1&gt;
&lt;p&gt;At the time when this model was developed (2013-05-28) most of the matches in the 2012/2013 season had been played and Barcelona was already the winner (and the most skilled team as predicted by my model). There were however some matches left, for example, Sevilla (home team) vs Valencia (away team) at the &lt;span class=&#34;math inline&#34;&gt;\(1\)&lt;/span&gt;st of June, 2013. One of the powers with using Bayesian modeling and MCMC sampling is that once you have the MCMC samples of the parameters it is straight forward to calculate any quantity resulting from these estimates while still retaining the uncertainty of the parameter estimates. So let’s look at the predicted distribution of the number of goals for the Sevilla vs Valencia game and see if I can use my model to make some money. I’ll start by using the MCMC samples to calculate the distribution of the number of goals for Sevilla and Valencia.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; n &amp;lt;- nrow(ms3)
&amp;gt; home_team &amp;lt;- which(teams == &amp;quot;FC Sevilla&amp;quot;)
&amp;gt; away_team &amp;lt;- which(teams == &amp;quot;FC Valencia&amp;quot;)
&amp;gt; season &amp;lt;- which(seasons == &amp;quot;2012/13&amp;quot;)
&amp;gt; home_skill &amp;lt;- ms3[, col_name(&amp;quot;skill&amp;quot;, season, home_team)]
&amp;gt; away_skill &amp;lt;- ms3[, col_name(&amp;quot;skill&amp;quot;, season, away_team)]
&amp;gt; home_baseline &amp;lt;- ms3[, col_name(&amp;quot;home_baseline&amp;quot;, season)]
&amp;gt; away_baseline &amp;lt;- ms3[, col_name(&amp;quot;away_baseline&amp;quot;, season)]
&amp;gt; 
&amp;gt; home_goals &amp;lt;- rpois(n, exp(home_baseline + home_skill - away_skill))
&amp;gt; away_goals &amp;lt;- rpois(n, exp(away_baseline + away_skill - home_skill))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Looking at summary of these two distributions shows that it will be a close game but with a slight advantage for the home team Sevilla.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; par(mfrow = c(2, 2), mar = rep(2.2, 4))
&amp;gt; plot_goals(home_goals, away_goals)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/JAGS/glmm-jags/2020-02-01-glmm-jags_files/figure-html/pp2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;When developing the model (2013-05-28) the author got the specific payouts (that is, how much would I get back if my bet was successful) for betting on the outcome of this game on a betting site. Using my simulated distribution of the number of goals I can calculate the predicted payouts of my model.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; 1/c(Sevilla = mean(home_goals &amp;gt; away_goals), Draw = mean(home_goals == away_goals),
+     Valencia = mean(home_goals &amp;lt; away_goals))
 Sevilla     Draw Valencia 
2.281369 3.841229 3.318584 &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I should clearly bet on Sevilla as my model predicts a payout of &lt;span class=&#34;math inline&#34;&gt;\(2.24\)&lt;/span&gt; (that is, a likely win for Sevilla) while betsson.com gives me the much higher payout of &lt;span class=&#34;math inline&#34;&gt;\(3.2\)&lt;/span&gt;. It is also possible to bet on the final goal outcome so let’s calculate what payouts my model predicts for different goal outcomes.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; goals_payout &amp;lt;- laply(0:6, function(home_goal) {
+     laply(0:6, function(away_goal) {
+         1/mean(home_goals == home_goal &amp;amp; away_goals == away_goal)
+     })
+ })
&amp;gt; 
&amp;gt; colnames(goals_payout) &amp;lt;- paste(&amp;quot;Valencia&amp;quot;, 0:6, sep = &amp;quot; - &amp;quot;)
&amp;gt; rownames(goals_payout) &amp;lt;- paste(&amp;quot;Sevilla&amp;quot;, 0:6, sep = &amp;quot; - &amp;quot;)
&amp;gt; goals_payout &amp;lt;- round(goals_payout, 1)
&amp;gt; knitr::kable(goals_payout, &amp;quot;pandoc&amp;quot;, align = &amp;quot;c&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Valencia - 0&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Valencia - 1&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Valencia - 2&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Valencia - 3&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Valencia - 4&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Valencia - 5&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Valencia - 6&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Sevilla - 0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;13.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;47.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;161.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;714.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2500.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Sevilla - 1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;13.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;122.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;441.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1666.7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Sevilla - 2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;12.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;19.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;56.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;176.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;625.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1875.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Sevilla - 3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;26.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;22.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;39.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;97.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;500.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1363.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Inf&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Sevilla - 4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;81.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;58.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;101.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;306.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1071.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3000.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Inf&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Sevilla - 5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;211.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;223.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;319.1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1000.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2500.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;15000.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Inf&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Sevilla - 6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;750.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;483.9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1500.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3000.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7500.0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Inf&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Inf&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The most likely result is 1 - 1 with a predicted payout of &lt;span class=&#34;math inline&#34;&gt;\(8.4\)&lt;/span&gt; and the beeting site agrees with this also offering their lowest payout for this bet, &lt;span class=&#34;math inline&#34;&gt;\(5.3\)&lt;/span&gt;. Not good enough! Looking at the payouts at the beeting site I can see that Sevilla - Valencia: 2 - 0 gives me a payout of &lt;span class=&#34;math inline&#34;&gt;\(16.0\)&lt;/span&gt;, that’s much better than my predicted payout of &lt;span class=&#34;math inline&#34;&gt;\(13.1\)&lt;/span&gt;. I’ll go for that!&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;conclusions&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;I believe the model has a lot things going for it. It is conceptually quite simple and easy to understand, implement and extend. It captures the patterns in and distribution of the data well. It allows me to easily calculate the probability of any outcome, from a game with whichever teams from any La Liga season. Want to calculate the probability that RCD Mallorca (home team) vs Malaga CF (away team) in the Season 2009/2010 would result in a draw? Easy! What’s the probability of the total number of goals in Granada CF vs Athletic Club Bilbao being a prime number? No problemo! What if Real Madrid from 2008/2009 met Barcelona from 2012/2013 in 2010/2011 and both teams had the home advantage? Well, that’s possible. There are also a couple of things that could be improved (many which are not too hard to address). Currently there is assumed to be no dependency between the goal distributions of the home and away teams, but this might not be realistic. Maybe if one team have scored more goals the other team “looses steam” (a negative correlation between the teams’ scores) or instead maybe the other team tries harder (a positive correlation). Such dependencies could maybe be added to the model using copulas. * One of the advantages of Bayesian statistics is the possibility to used informative priors. As I have no knowledge of football I’ve been using vague priors but with the help of a more knowledgeable football fan the model could be given more informative priors. Also, the predictive performance of the model has not been as thoroughly examined and this could be remedied with a healthy dose of cross validation.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;references&#34; class=&#34;section level1 unnumbered&#34;&gt;
&lt;h1&gt;References&lt;/h1&gt;
&lt;div id=&#34;refs&#34; class=&#34;references&#34;&gt;
&lt;div id=&#34;ref-baaaath2015modeling&#34;&gt;
&lt;p&gt;Bååth, Rasmus. 2015. “Modeling Match Results in Soccer Using a Hierarchical Bayesian Poisson Model.” Technical Report LUCS minor 18, Lund University Cognitive Science, Lund, Sweden.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-plummer2004jags&#34;&gt;
&lt;p&gt;Plummer, Martyn. 2004. “JAGS: Just Another Gibbs Sampler.”&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-su2015package&#34;&gt;
&lt;p&gt;Su, Yu-Sung, Masanao Yajima, Maintainer Yu-Sung Su, and JAGS SystemRequirements. 2015. “Package ‘R2jags’.” &lt;em&gt;R Package Version 0.03-08, URL Http://CRAN. R-Project. Org/Package= R2jags&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Generalised Linear Mixed Models - STAN</title>
      <link>/stan/glmm-stan/glmm-stan/</link>
      <pubDate>Sat, 15 Feb 2020 21:13:14 -0500</pubDate>
      
      <guid>/stan/glmm-stan/glmm-stan/</guid>
      <description>


&lt;p&gt;This tutorial will focus on the use of Bayesian estimation to fit simple linear regression models. &lt;code&gt;BUGS&lt;/code&gt; (Bayesian inference Using &lt;em&gt;Gibbs Sampling&lt;/em&gt;) is an algorithm and supporting language (resembling &lt;code&gt;R&lt;/code&gt;) dedicated to performing the Gibbs sampling implementation of &lt;em&gt;Markov Chain Monte Carlo&lt;/em&gt; (MCMC) method. Dialects of the &lt;code&gt;BUGS&lt;/code&gt; language are implemented within three main projects:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;OpenBUGS&lt;/strong&gt; - written in component pascal.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;JAGS&lt;/strong&gt; - (Just Another Gibbs Sampler) - written in &lt;code&gt;C++&lt;/code&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;STAN&lt;/strong&gt; - a dedicated Bayesian modelling framework written in &lt;code&gt;C++&lt;/code&gt; and implementing &lt;em&gt;Hamiltonian&lt;/em&gt; MCMC samplers.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Whilst the above programs can be used stand-alone, they do offer the rich data pre-processing and graphical capabilities of &lt;code&gt;R&lt;/code&gt;, and thus, they are best accessed from within &lt;code&gt;R&lt;/code&gt; itself. As such there are multiple packages devoted to interfacing with the various software implementations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;R2OpenBUGS&lt;/em&gt; - interfaces with &lt;code&gt;OpenBUGS&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;R2jags&lt;/em&gt; - interfaces with &lt;code&gt;JAGS&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;rstan&lt;/em&gt; - interfaces with &lt;code&gt;STAN&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This tutorial will demonstrate how to fit models in &lt;code&gt;STAN&lt;/code&gt; (&lt;span class=&#34;citation&#34;&gt;Gelman, Lee, and Guo (2015)&lt;/span&gt;) using the package &lt;code&gt;rstan&lt;/code&gt; (&lt;span class=&#34;citation&#34;&gt;Stan Development Team (2018)&lt;/span&gt;) as interface, which also requires to load some other packages.&lt;/p&gt;
&lt;div id=&#34;overview&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Overview&lt;/h1&gt;
&lt;p&gt;In some respects, &lt;em&gt;Generalized Linear Mixed effects Models&lt;/em&gt; (GLMM) are a hierarchical extension of &lt;em&gt;Generalized linear models&lt;/em&gt; (GLM) in a similar manner that Linear Mixed effects Models (LMM) are a hierarchical extension of Linear Models (LM). However, whilst the Gaussian (normal) distribution facilitates a relatively straight way of generating the marginal likelihood of the observed response by integrating likelihoods across all possible (and unobserved) levels of a random effect to yield parameter estimates, the same cannot be said for other distributions. Consequently various approximations have been developed to estimate the fixed and random parameters for GLMM’s:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Penalized quasi-likelihood&lt;/strong&gt; (PQL). This method approximates a quasi-likelihood by iterative fitting of (re)weighted linear mixed effects models based on the fit of GLM fit. Specifically, it estimates the fixed effects parameters by fitting a GLM that incorporates a correlation (variance-covariance) structure resulting from a LMM and then refits a LMM to re-estimate the variance-covariance structure by using the variance structure from the previous GLM. The cycle continues to iterate until either the fit improvement is below a threshold or a defined number of iterations has occurred. Whilst this is a relatively simple approach, that enables us to leverage methodologies for accommodating heterogeneity and spatial/temporal autocorrelation, it is known to perform poorly (estimates biased towards large variance) for Poisson distributions when the expected value is less than &lt;span class=&#34;math inline&#34;&gt;\(5\)&lt;/span&gt; and for binary data when the expected number of successes or failures are less than &lt;span class=&#34;math inline&#34;&gt;\(5\)&lt;/span&gt;. Moreover, as it approximates quasi-likelihood rather than likelihood, likelihood based inference and information criterion methods (such as likelihood ratio tests and AIC) are not appropriate with this approach. Instead, Wald tests are required for inference.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Laplace approximation&lt;/strong&gt;. This approach utilises a second-order Taylor series expansion to approximate (a mathematical technique for approximating the properties of a function around a point by taking multiple derivatives of the function and summing them together) the likelihood function. If we assume that the likelihood function is approximately normal and thus a quadratic function on a log scale, we can use second-order Taylor series expansion to approximate this likelihood. Whilst this approach is considered to be more accurate than PQL, it is considerably slower and unable to accommodate alternative variance and correlation structures.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Gauss-Hermite quadrature&lt;/strong&gt; (GHQ). This approach approximates the marginal likelihood by approximating the value of integrals at specific points (quadratures). This technique can be further adapted by allowing the number of quadratures and their weights to be optimized via a set of rules.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Markov-chain Monte-Carlo&lt;/strong&gt; (MCMC). This takes a bruit force approach by recreating the likelihood by traversing the likelihood function with sequential sampling proportional to the likelihood. Although this approach is very robust (when the posteriors have converged), they are computationally very intense. Interestingly, some (including Andrew Gelman) argue that PQL, Laplace and GHQ do not yield estimates. Rather they are only approximations of estimates. By contrast, as MCMC methods are able to integrate over all levels by bruit force, the resulting parameters are indeed true estimates.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We will focus on the last approach which is the more general among the ones considered here and which is based on a Bayesian approach, which can be very flexible and accurate, yet very slow and complex.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;hierarchical-poisson-regression&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Hierarchical Poisson regression&lt;/h1&gt;
&lt;p&gt;The model I will be developing is a Bayesian hierarchical Poisson regression model which I used for the modelling of match results in volleyball, also available as a published &lt;a href=&#34;https://www.tandfonline.com/doi/full/10.1080/02664763.2020.1723506?casa_token=5NyZAGE970gAAAAA%3AjcSlhut9cztg1nQheK_Z3NZPUuKvwUAcodvBD7g47amY1Cb-ViZZFt-ikcaYhU7o7sIzwEOOcEgH&#34;&gt;paper&lt;/a&gt;. The objective of the analysis is to model the match results from the season 2017-2018 of &lt;em&gt;Serie A1&lt;/em&gt;, the premium Italian female volleyball league. In total there were &lt;span class=&#34;math inline&#34;&gt;\(136\)&lt;/span&gt; games (rows) in the dataset each with information regarding which was the home and away team, what these teams scored, whether the match ended with &lt;span class=&#34;math inline&#34;&gt;\(4\)&lt;/span&gt; or &lt;span class=&#34;math inline&#34;&gt;\(5\)&lt;/span&gt; sets, and additional in-game statistics such as number of attacks, digs, serves, and blocks for each team in each match. The point outcomes of the teams in the games are assumed to be distributed according to a Poisson distribution. This model is similar to other models used for the modelling of football results, where the points scored by the home and away teams are defined as a function of latent attacking and defensive skills of the teams estimated across the games.&lt;/p&gt;
&lt;p&gt;The peculiar (and novel) aspect of the model is that it takes into account the features of volleyball to generate plausible game results and league points scored by the teams across the season. In particular, for modelling purposes it is important to accout for the following aspects. 1) according to the current scoring system, matches are played until a team wins a total of three sets, with each set typically going to &lt;span class=&#34;math inline&#34;&gt;\(25\)&lt;/span&gt; points. However, if the two teams won two sets each, the third set then goes only up to &lt;span class=&#34;math inline&#34;&gt;\(15\)&lt;/span&gt; points. 2) a team must win each set by &lt;span class=&#34;math inline&#34;&gt;\(2\)&lt;/span&gt; points. If the score is tied with even numbers, both teams have to continue playing the set until a &lt;span class=&#34;math inline&#34;&gt;\(2\)&lt;/span&gt;-point lead is obtained. Otherwise, points keep accumulating until one team wins with a margin of victory of &lt;span class=&#34;math inline&#34;&gt;\(2\)&lt;/span&gt; points, even if the score is greater than &lt;span class=&#34;math inline&#34;&gt;\(25\)&lt;/span&gt; or &lt;span class=&#34;math inline&#34;&gt;\(15\)&lt;/span&gt; points. 3) in professional volleyball leagues, the teams get points according to set numbers at the end of all matches in the league. More specifically, the team points are awarded as follows: if the match is won &lt;span class=&#34;math inline&#34;&gt;\(3–0\)&lt;/span&gt; or &lt;span class=&#34;math inline&#34;&gt;\(3–1\)&lt;/span&gt;, &lt;span class=&#34;math inline&#34;&gt;\(3\)&lt;/span&gt; points are assigned to the winner and &lt;span class=&#34;math inline&#34;&gt;\(0\)&lt;/span&gt; points to the loser; if the match is won &lt;span class=&#34;math inline&#34;&gt;\(3–2\)&lt;/span&gt;, &lt;span class=&#34;math inline&#34;&gt;\(2\)&lt;/span&gt; points are assigned to the winner and &lt;span class=&#34;math inline&#34;&gt;\(1\)&lt;/span&gt; point to the loser.&lt;/p&gt;
&lt;p&gt;The model is a Bayesian hierarchical analysis of volleyball data which allows to jointly predict match results and team rankings in national leagues. I use data from the women’s volleyball Italian Serie A1 &lt;span class=&#34;math inline&#34;&gt;\(2017–2018\)&lt;/span&gt; season as a motivating example to implement and validate the model.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;loading-the-data&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Loading the data&lt;/h1&gt;
&lt;p&gt;I start by loading libraries, reading in the data and preprocessing it for &lt;code&gt;STAN&lt;/code&gt;. In the original verison of the analysis I used &lt;code&gt;JAGS&lt;/code&gt; and a slightly more complicated model which I do not consider here, but that you may consult in my paper if interested (&lt;span class=&#34;citation&#34;&gt;Gabrio (2020)&lt;/span&gt;).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; library(plyr)
&amp;gt; library(dplyr)
&amp;gt; library(rstan)
&amp;gt; library(bayesplot)
&amp;gt; library(boot)
&amp;gt; library(ggplot2)
&amp;gt; library(scales)
&amp;gt; library(RColorBrewer)
&amp;gt; library(viridis)
&amp;gt; set.seed(12345)  # for reproducibility
&amp;gt; 
&amp;gt; #load data
&amp;gt; data&amp;lt;-read.csv(file = &amp;quot;Volley_prepro_v1.csv&amp;quot;,header = T)
&amp;gt; data$home.team&amp;lt;-as.factor(data$home.team)
&amp;gt; data$away.team&amp;lt;-as.factor(data$away.team)
&amp;gt; data$bloeff1&amp;lt;-(data$bloper1-data$bloinv1)/(data$blo1+data$bloper1)
&amp;gt; data$bloeff2&amp;lt;-(data$bloper2-data$bloinv2)/(data$blo2+data$bloper2)
&amp;gt; data_stat1&amp;lt;-ddply(data, .(h), summarise, meanatteff1=mean(atteff1),meansereff1=mean(sereff1),
+                   meandefeff1=mean(defeff1),meanbloeff1=mean(bloeff1))
&amp;gt; data_stat2&amp;lt;-ddply(data, .(a), summarise, meanatteff2=mean(atteff2),meansereff2=mean(sereff2),
+                   meandefeff2=mean(defeff2),meanbloeff2=mean(bloeff2))
&amp;gt; #center cov grand mean
&amp;gt; atteff1.cen&amp;lt;-data$atteff1-mean(data$atteff1)
&amp;gt; sereff1.cen&amp;lt;-data$sereff1-mean(data$sereff1)
&amp;gt; bloeff1.cen&amp;lt;-data$bloeff1-mean(data$bloeff1)
&amp;gt; defeff1.cen&amp;lt;-data$defeff1-mean(data$defeff1)
&amp;gt; 
&amp;gt; atteff2.cen&amp;lt;-data$atteff2-mean(data$atteff2)
&amp;gt; sereff2.cen&amp;lt;-data$sereff2-mean(data$sereff2)
&amp;gt; bloeff2.cen&amp;lt;-data$bloeff2-mean(data$bloeff2)
&amp;gt; defeff2.cen&amp;lt;-data$defeff2-mean(data$defeff2)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;data-check&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Data check&lt;/h2&gt;
&lt;p&gt;How are the number of points for each team in a volleyball match distributed? Well, let’s start by assuming that both teams have many chances at making a point and that each team have the same probability of scoring each point chance. Given these assumptions the distribution of the number of points for each team should be well captured by a Poisson distribution. A quick and dirty comparison between the actual distribution of the number of scored goals and a Poisson distribution having the same mean number of scored goals support this notion.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; par(mfcol = c(2, 1), mar = rep(2.2, 4))
&amp;gt; hist(c(data$y2, data$y1), xlim = c(40, 120), breaks = 8,main = &amp;quot;Distribution of the number of points\nscored by a team in a match.&amp;quot;)
&amp;gt; mean_goals &amp;lt;- mean(c(data$y2, data$y1))
&amp;gt; hist(rpois(9999, mean_goals), xlim = c(40, 120), breaks = 8 ,main = &amp;quot;Random draw from a Poisson distribution with\nthe same mean as the distribution above.&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/STAN/glmm-stan/2020-02-01-glmm-stan_files/figure-html/data_check-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;model-fitting&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Model fitting&lt;/h2&gt;
&lt;p&gt;All teams aren’t equally good and it will be assumed that all teams have a latent skill variable and the skill of a team minus the skill of the opposing team defines the predicted outcome of a game. As the number of goals are assumed to be Poisson distributed it is natural that the skills of the teams are on the log scale of the mean of the distribution. The distribution of the number of goals for the home team &lt;span class=&#34;math inline&#34;&gt;\(i\)&lt;/span&gt; when facing the away team &lt;span class=&#34;math inline&#34;&gt;\(j\)&lt;/span&gt; is then&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{Points} \sim \text{Pois}(\lambda)\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;where &lt;span class=&#34;math inline&#34;&gt;\(\log(\lambda)=\mu + \text{home} + \text{skill}_i - \text{skill}_j\)&lt;/span&gt;. &lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt; is a constant, while home is the advantage for the team hosting the game which is typically assumed to be constant for all the teams and throughout the season. The point outcome of a match between home team &lt;span class=&#34;math inline&#34;&gt;\(i\)&lt;/span&gt; and away team &lt;span class=&#34;math inline&#34;&gt;\(j\)&lt;/span&gt; is modeled as:&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{HomePoins}_{ij} \sim \text{Pois}(\lambda_{\text{home},ij}),\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{AwayPoints}_{ij} \sim \text{Pois}(\lambda_{\text{away},ij}),\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;where&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \log(\lambda_{\text{home},ij}) = \mu + \text{home} + \text{skill}_i - \text{skill}_j, \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \log(\lambda_{\text{away},ij}) = \mu + \text{skill}_j - \text{skill}_i. \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The skill parameters for the home and away teams are specified as a function of a set of attack and defense skills, which in turn are a linear function of different in-game statistics including the number of attacks, digs, serves and blocks for each team:&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{skill}_i = \alpha_{0i} + \alpha_{1i}\text{attacks} + \alpha_{2i}\text{serves} + , \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{skill}_j = \beta_{0j} + \beta_{1j}\text{digs} + \beta_{2j}\text{blocks}, \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The distribution of two indicator variables, related to whether or not the fifth set was played (&lt;span class=&#34;math inline&#34;&gt;\(d^s\)&lt;/span&gt;) and whether the home team was the winner (&lt;span class=&#34;math inline&#34;&gt;\(d^g\)&lt;/span&gt;) in each match, are aslo included in the model. These are modelled as:&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ d^s \sim \text{Bernoulli}(\pi^s) \;\;\; \text{and} \;\;\; d^g \sim \text{Bernoulli}(\pi^g), \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;where the corresponding probabilities are specified as&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{logit}(\pi^s) = \gamma_{0} + \gamma_1\text{HomePoins}_{i} + \gamma_2\text{AwayPoins}_{j}, \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{logit}(\pi^g) = \delta_{0} + \delta_1\text{HomePoins}_{i} + \delta_2\text{AwayPoins}_{j} + \delta_3d^g. \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;I set the prior distributions over &lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt; and &lt;span class=&#34;math inline&#34;&gt;\(\text{home}\)&lt;/span&gt; to:&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{home} \sim N(0, 10000) \;\;\; \text{and} \;\;\; \mu \sim N(0, 10000),\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;weakly informative priors on &lt;span class=&#34;math inline&#34;&gt;\(\boldsymbol \gamma\)&lt;/span&gt;, &lt;span class=&#34;math inline&#34;&gt;\(\boldsymbol \delta\)&lt;/span&gt;, and set the priors on the skill of all &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; teams using a hierarchical approach to :&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ \text{skill}_{1,\ldots,n} \sim N(\mu_{\text{teams}}, \sigma^2_{\text{teams}}),\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;so that teams are assumed to have similar but not identical mean and variance parameters for thier skill parameters. Turning this into a &lt;code&gt;STAN&lt;/code&gt; model requires some minor adjustments. I have to “anchor” the sum of team skills to a constant otherwise the mean skill can drift away freely (&lt;em&gt;sum to zero constraint&lt;/em&gt;) and the model cannot be identified. Doing these adjustments results in the following model description:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; rstanString&amp;lt;-&amp;quot;
+ data{
+ int&amp;lt;lower=1&amp;gt; nteams; // number of teams
+ int&amp;lt;lower=1&amp;gt; ngames; // number of games
+ int&amp;lt;lower=1, upper=nteams&amp;gt; home_team[ngames]; // home team ID (1, ..., 12)
+ int&amp;lt;lower=1, upper=nteams&amp;gt; away_team[ngames]; // away team ID (1, ..., 12)
+ vector [ngames] att_eff1; // in game statistics for number of attacks (home)
+ vector [ngames] ser_eff1; // in game statistics for number of serves (home)
+ vector [ngames] def_eff2; // in game statistics for number of digs (away)
+ vector [ngames] blo_eff2; // in game statistics for number of blocks (away)
+ vector [ngames] att_eff2; // in game statistics for number of attacks (away)
+ vector [ngames] ser_eff2; // in game statistics for number of serves (away)
+ vector [ngames] def_eff1; // in game statistics for number of digs (home)
+ vector [ngames] blo_eff1; // in game statistics for number of blocks (home)
+ int&amp;lt;lower=0&amp;gt; y1[ngames]; // number of points scored by home team
+ int&amp;lt;lower=0&amp;gt; y2[ngames]; // number of points scored by away team
+ int&amp;lt;lower=0, upper=1&amp;gt; ds[ngames]; // indicator for number of sets played (3/4 or 5)
+ int&amp;lt;lower=0, upper=1&amp;gt; dg[ngames]; // indicator for winning of the match for home team
+ }
+ parameters{
+ real home;
+ real mu;
+ real mu0_att;
+ real mu0_def;
+ real&amp;lt;lower=0&amp;gt; sigma0_att;
+ real&amp;lt;lower=0&amp;gt; sigma0_def;
+ real mu1_att;
+ real mu1_def;
+ real&amp;lt;lower=0&amp;gt; sigma1_att;
+ real&amp;lt;lower=0&amp;gt; sigma1_def;
+ real mu1_ser;
+ real mu1_blo;
+ real&amp;lt;lower=0&amp;gt; sigma1_ser;
+ real&amp;lt;lower=0&amp;gt; sigma1_blo;
+ vector [nteams] beta0_att_star;
+ vector [nteams] beta1_att_star;
+ vector [nteams] beta1_ser_star;
+ vector [nteams] beta0_def_star;
+ vector [nteams] beta1_def_star;
+ vector [nteams] beta1_blo_star;
+ real gamma[3];
+ real delta[4];
+ }
+ transformed parameters{
+ //Trick to code the sum-to-zero constraint
+ vector [nteams] beta0_att;
+ vector [nteams] beta1_att;
+ vector [nteams] beta1_ser;
+ vector [nteams] beta0_def;
+ vector [nteams] beta1_def;
+ vector [nteams] beta1_blo;
+ vector&amp;lt;lower=0&amp;gt;[ngames] theta1;
+ vector&amp;lt;lower=0&amp;gt;[ngames] theta2;
+ beta0_att = beta0_att_star - mean(beta0_att_star);
+ beta1_att = beta1_att_star - mean(beta1_att_star);
+ beta1_ser = beta1_ser_star - mean(beta1_ser_star);
+ beta0_def = beta0_def_star - mean(beta0_def_star);
+ beta1_def = beta1_def_star - mean(beta1_def_star);
+ beta1_blo = beta1_blo_star - mean(beta1_blo_star);
+  for (g in 1:ngames) {
+     theta1[g] = exp(home + mu + beta0_att[home_team[g]] + beta1_att[home_team[g]]*att_eff1[g] + beta1_ser[home_team[g]]*ser_eff1[g] + 
+              beta0_def[away_team[g]] + beta1_def[away_team[g]]*def_eff2[g] + beta1_blo[away_team[g]]*blo_eff2[g]); 
+     theta2[g] = exp(home + mu + beta0_att[away_team[g]] + beta1_att[away_team[g]]*att_eff1[g] + beta1_ser[away_team[g]]*ser_eff1[g] + 
+              beta0_def[home_team[g]] + beta1_def[home_team[g]]*def_eff2[g] + beta1_blo[home_team[g]]*blo_eff2[g]); 
+  }
+ }
+ model {
+ //priors
+ home ~ normal(0, 100);
+ mu ~ normal(0, 100);
+ mu0_att ~ normal(0, 100);
+ mu0_def ~ normal(0, 100);
+ sigma0_att ~ uniform(0, 100);
+ sigma0_def ~ uniform(0, 100);
+ mu1_att ~ normal(0, 100);
+ mu1_def ~ normal(0, 100);
+ sigma1_att ~ uniform(0, 100);
+ sigma1_def ~ uniform(0, 100);
+ mu1_ser ~ normal(0, 100);
+ mu1_blo ~ normal(0, 100);
+ sigma1_ser ~ uniform(0, 100);
+ sigma1_blo ~ uniform(0, 100);
+ gamma ~ normal(0, 100);
+ delta ~ normal(0, 100);
+ beta0_att_star ~ normal(mu0_att, sigma0_att);
+ beta0_def_star ~ normal(mu0_def, sigma0_def);
+ beta1_att_star ~ normal(mu1_att, sigma1_att);
+ beta1_def_star ~ normal(mu1_def, sigma1_def);
+ beta1_ser_star ~ normal(mu1_ser, sigma1_ser);
+ beta1_blo_star ~ normal(mu1_blo, sigma1_blo);
+ // likelihood
+  for (g in 1:ngames) {
+   y1[g] ~ poisson(theta1[g]);
+   y2[g] ~ poisson(theta2[g]);
+   ds[g] ~ bernoulli_logit(gamma[1] + gamma[2]*y1[g] + gamma[3]*y2[g]);
+   dg[g] ~ bernoulli_logit(delta[1] + delta[2]*y1[g] + delta[3]*y2[g] + delta[4]*ds[g]);
+  }
+ }
+ generated quantities{
+ // loglikelihood 
+ vector[ngames] loglik_y1;
+ vector[ngames] loglik_y2;
+ vector[ngames] loglik_ds;
+ vector[ngames] loglik_dg;
+  for (g in 1:ngames) {
+   loglik_y1[g] = poisson_lpmf(y1[g]| theta1[g]);
+   loglik_y2[g] = poisson_lpmf(y2[g]| theta2[g]);
+   loglik_ds[g] = bernoulli_logit_lpmf(ds[g]| gamma[1] + gamma[2]*y1[g] + gamma[3]*y2[g]);
+   loglik_dg[g] = bernoulli_logit_lpmf(dg[g]| delta[1] + delta[2]*y1[g] + delta[3]*y2[g] + delta[4]*ds[g]);
+  }
+ }
+ 
+ &amp;quot;
&amp;gt; 
&amp;gt; ## write the model to a text file
&amp;gt; writeLines(rstanString, con = &amp;quot;Modelbasic.stan&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Next, we put the data into a list to be passed to &lt;code&gt;STAN&lt;/code&gt;, define the nodes (parameters and derivatives) to monitor and the chain parameters.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; #prepare data
&amp;gt; y1&amp;lt;-data$y1
&amp;gt; y2&amp;lt;-data$y2
&amp;gt; ngames&amp;lt;-max(data$Game)
&amp;gt; nteams&amp;lt;-max(data$h)
&amp;gt; home_team&amp;lt;-data$h
&amp;gt; away_team&amp;lt;-data$a
&amp;gt; 
&amp;gt; att_eff1&amp;lt;-data$atteff1
&amp;gt; att_eff2&amp;lt;-data$atteff2
&amp;gt; ser_eff1&amp;lt;-data$sereff1
&amp;gt; ser_eff2&amp;lt;-data$sereff2
&amp;gt; blo_eff1&amp;lt;-data$bloeff1
&amp;gt; blo_eff2&amp;lt;-data$bloeff2
&amp;gt; def_eff1&amp;lt;-data$defeff1
&amp;gt; def_eff2&amp;lt;-data$defeff2
&amp;gt; 
&amp;gt; att_eff1&amp;lt;-atteff1.cen
&amp;gt; att_eff2&amp;lt;-atteff2.cen
&amp;gt; ser_eff1&amp;lt;-sereff1.cen
&amp;gt; ser_eff2&amp;lt;-sereff2.cen
&amp;gt; blo_eff1&amp;lt;-bloeff1.cen
&amp;gt; blo_eff2&amp;lt;-bloeff2.cen
&amp;gt; def_eff1&amp;lt;-defeff1.cen
&amp;gt; def_eff2&amp;lt;-defeff2.cen
&amp;gt; 
&amp;gt; ds&amp;lt;-ifelse(data$settot==5,1,0)
&amp;gt; dg&amp;lt;-ifelse(data$set1&amp;gt;data$set2,1,0)
&amp;gt; 
&amp;gt; #pre-processing
&amp;gt; datalist &amp;lt;- list(y1=y1,y2=y2,ngames=ngames,nteams=nteams,home_team=home_team,away_team=away_team,att_eff1=att_eff1,att_eff2=att_eff2,def_eff1=def_eff1,def_eff2=def_eff2,ser_eff1=ser_eff1,ser_eff2=ser_eff2,blo_eff1=blo_eff1,blo_eff2=blo_eff2,ds=ds, dg=dg)
&amp;gt; params &amp;lt;- c(&amp;quot;mu&amp;quot;,&amp;quot;home&amp;quot;,&amp;quot;gamma&amp;quot;,&amp;quot;delta&amp;quot;,&amp;quot;beta0_att&amp;quot;,&amp;quot;beta0_def&amp;quot;,
+             &amp;quot;beta1_att&amp;quot;,&amp;quot;beta1_def&amp;quot;,&amp;quot;beta1_ser&amp;quot;,&amp;quot;beta1_blo&amp;quot;,&amp;quot;theta1&amp;quot;,
+             &amp;quot;theta2&amp;quot;,&amp;quot;loglik_y1&amp;quot;,&amp;quot;loglik_y2&amp;quot;,&amp;quot;loglik_ds&amp;quot;,&amp;quot;loglik_dg&amp;quot;)
&amp;gt; burnInSteps = 2000
&amp;gt; nChains = 2
&amp;gt; numSavedSteps = 10000
&amp;gt; thinSteps = 1
&amp;gt; nIter = ceiling((numSavedSteps * thinSteps)/nChains)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Start the &lt;code&gt;STAN&lt;/code&gt; model (check the model, load data into the model, specify the number of chains and compile the model). Run the &lt;code&gt;STAN&lt;/code&gt; code via the &lt;code&gt;rstan&lt;/code&gt; package and the &lt;code&gt;stan&lt;/code&gt; function.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; model_stan&amp;lt;- stan(data = datalist, file = &amp;quot;Modelbasic.stan&amp;quot;, 
+                        chains = nChains, pars = params, iter = nIter, 
+                        warmup = burnInSteps, thin = thinSteps)
&amp;gt; print(model_stan, pars =c(&amp;quot;mu&amp;quot;,&amp;quot;home&amp;quot;,&amp;quot;gamma&amp;quot;,&amp;quot;delta&amp;quot;,&amp;quot;beta0_att&amp;quot;,
+                           &amp;quot;beta0_def&amp;quot;,&amp;quot;beta1_att&amp;quot;,&amp;quot;beta1_def&amp;quot;,
+                           &amp;quot;beta1_ser&amp;quot;,&amp;quot;beta1_blo&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The diagnostic results are not perfect, perhaps I should run the algorithm a bit longer to get better results as a total of &lt;span class=&#34;math inline&#34;&gt;\(5000\)&lt;/span&gt; iterations does not seem enough. Here I do not bother to save time. To get an idea about posterior results I can plot at the average marginal mean offensive and defensive skills for each of the &lt;span class=&#34;math inline&#34;&gt;\(12\)&lt;/span&gt; teams in the league using the following code.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; #plot att vs def effext by team
&amp;gt; model_stan_par&amp;lt;-extract(model_stan)
&amp;gt; 
&amp;gt; beta0.att&amp;lt;-apply(model_stan_par$beta0_att, 2, mean)
&amp;gt; beta0.def&amp;lt;-apply(model_stan_par$beta0_def, 2, mean)
&amp;gt; names&amp;lt;-unique(data.frame(data$home.team,data$h)[order(data$h),][,1])
&amp;gt; 
&amp;gt; plot(beta0.att,beta0.def, main = &amp;quot;&amp;quot;, type = &amp;quot;n&amp;quot;, xlab = &amp;quot;Mean attack effect&amp;quot;, ylab = &amp;quot;Mean defence effect&amp;quot;, xlim=c(-0.13,0.08), ylim=c(-0.18,0.1))
&amp;gt; points(beta0.att,beta0.def, pch=16, col=&amp;quot;red&amp;quot;,cex = 1.2)
&amp;gt; abline(v=0)
&amp;gt; abline(h=0)
&amp;gt; text(beta0.att,beta0.def,names,cex = 0.8, adj = c(0.4,1.3))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Different clusters of teams can be easily detected and suggest a different performance of the teams based on their average offensive and defensive skills. Those associated with higher offensive (to the right) and lower defensive (to the bottom) effects are the ones with the best performance across the season.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;mcmc-diagnostics&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;MCMC diagnostics&lt;/h2&gt;
&lt;p&gt;Using the generated MCMC samples I can now look at some diagnostic measures. For example, we can assess convergence of the chains using the function &lt;code&gt;mcmc_combo&lt;/code&gt; in the package &lt;code&gt;bayesplot&lt;/code&gt; which provides a summary of convergence diagnostics using different graphics. We consider the marginal skill parameters for four teams to give an example.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; mcmc_combo(model_stan, pars=c(&amp;quot;beta0_att[1]&amp;quot;,&amp;quot;beta0_att[2]&amp;quot;,
+                               &amp;quot;beta0_att[3]&amp;quot;,&amp;quot;beta0_att[4]&amp;quot;))
&amp;gt; mcmc_combo(model_stan, pars=c(&amp;quot;beta0_def[1]&amp;quot;,&amp;quot;beta0_def[2]&amp;quot;,
+                               &amp;quot;beta0_def[3]&amp;quot;,&amp;quot;beta0_def[4]&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;model-validation&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Model validation&lt;/h2&gt;
&lt;p&gt;We can finally assess the fit of the model to the data by computing posterior predictive checks, where we use the posterior values of the parameters to sample a large number of replications for the data. We then use these to generate different types of results and compare them with the actual results to detect possible misfits of the model.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; #obtain parameters to generate replications
&amp;gt; y1.pred&amp;lt;-y2.pred&amp;lt;-matrix(NA,length(model_stan_par$home),132)
&amp;gt; ds.pred&amp;lt;-dg.pred&amp;lt;-matrix(NA,length(model_stan_par$home),132)
&amp;gt; pi.s&amp;lt;-pi.g&amp;lt;-matrix(NA,length(model_stan_par$home),132)
&amp;gt; y1.mat&amp;lt;-y2.mat&amp;lt;-ds.mat&amp;lt;-matrix(NA,length(model_stan_par$home),132)
&amp;gt; for(i in 1:length(model_stan_par$home)){
+  y1.mat[i,]&amp;lt;-y1
+  y2.mat[i,]&amp;lt;-y2
+  ds.mat[i,]&amp;lt;-ds
+  pi.s[i,]&amp;lt;-inv.logit(model_stan_par$gamma[i,1] + model_stan_par$gamma[i,2]*y1.mat[i,] + model_stan_par$gamma[i,3]*y2.mat[i,])
+  pi.g[i,]&amp;lt;-inv.logit(model_stan_par$delta[i,1] + model_stan_par$delta[i,2]*y1.mat[i,] + model_stan_par$delta[i,3]*y2.mat[i,] + model_stan_par$delta[i,4]*ds.mat[i,])
+ }
&amp;gt; 
&amp;gt; #generate predictions
&amp;gt; set.seed(3456)
&amp;gt; for(i in 1:length(model_stan_par$home)){
+   y1.pred[i,]&amp;lt;-rpois(n=132,lambda = model_stan_par$theta1[i,])
+   y2.pred[i,]&amp;lt;-rpois(n=132,lambda = model_stan_par$theta2[i,])
+   ds.pred[i,]&amp;lt;-rbinom(n=132, size = 1,prob = pi.s[i,])
+   dg.pred[i,]&amp;lt;-rbinom(n=132, size = 1,prob = pi.g[i,])
+ }
&amp;gt; 
&amp;gt; #compute prediction points
&amp;gt; results&amp;lt;-list()
&amp;gt; for(i in 1:1000){
+   results[[i]]&amp;lt;-data.frame(y1.pred[i,],y2.pred[i,],ds.pred[i,],dg.pred[i,],data$h,data$a) 
+   results[[i]]$points.home&amp;lt;-ifelse(results[[i]]$ds.pred.i...==0 &amp;amp; results[[i]]$dg.pred.i...==1,3,0)
+   results[[i]]$points.home&amp;lt;-ifelse(results[[i]]$ds.pred.i...==1 &amp;amp; results[[i]]$dg.pred.i...==1,2,results[[i]]$points.home)
+   results[[i]]$points.home&amp;lt;-ifelse(results[[i]]$ds.pred.i...==1 &amp;amp; results[[i]]$dg.pred.i...==0,1,results[[i]]$points.home)
+   
+   results[[i]]$points.away&amp;lt;-ifelse(results[[i]]$ds.pred.i...==0 &amp;amp; results[[i]]$dg.pred.i...==0,3,0)
+   results[[i]]$points.away&amp;lt;-ifelse(results[[i]]$ds.pred.i...==1 &amp;amp; results[[i]]$dg.pred.i...==0,2,results[[i]]$points.away)
+   results[[i]]$points.away&amp;lt;-ifelse(results[[i]]$ds.pred.i...==1 &amp;amp; results[[i]]$dg.pred.i...==1,1,results[[i]]$points.away)
+ }
&amp;gt; 
&amp;gt; #compare results for scores by team
&amp;gt; tot.y1.list&amp;lt;-tot.y2.list&amp;lt;-list()
&amp;gt; for(i in 1:1000){
+   tot.y1.list[[i]]&amp;lt;-ddply(results[[i]], .(data.h), summarise, totscorehome=sum(y1.pred.i...))
+   tot.y2.list[[i]]&amp;lt;-ddply(results[[i]], .(data.a), summarise, totscoreaway=sum(y2.pred.i...))
+ }
&amp;gt; tot.y1.list.neg&amp;lt;-tot.y2.list.neg&amp;lt;-list()
&amp;gt; for(i in 1:1000){
+   tot.y1.list.neg[[i]]&amp;lt;-ddply(results[[i]], .(data.h), summarise, totscorehomeneg=sum(y2.pred.i...))
+   tot.y2.list.neg[[i]]&amp;lt;-ddply(results[[i]], .(data.a), summarise, totscoreawayneg=sum(y1.pred.i...))
+ }
&amp;gt; 
&amp;gt; 
&amp;gt; tot.y1.list.mat&amp;lt;-tot.y2.list.mat&amp;lt;-matrix(NA,1000,12)
&amp;gt; tot.y1.list.neg.mat&amp;lt;-tot.y2.list.neg.mat&amp;lt;-matrix(NA,1000,12)
&amp;gt; for(i in 1:1000){
+   tot.y1.list.mat[i,]&amp;lt;-tot.y1.list[[i]][,2]
+   tot.y2.list.mat[i,]&amp;lt;-tot.y2.list[[i]][,2]
+   tot.y1.list.neg.mat[i,]&amp;lt;-tot.y1.list.neg[[i]][,2]
+   tot.y2.list.neg.mat[i,]&amp;lt;-tot.y2.list.neg[[i]][,2]
+ }
&amp;gt; tot.y1.obs&amp;lt;-ddply(data, .(h), summarise, totscorehomeobs=sum(y1))
&amp;gt; tot.y2.obs&amp;lt;-ddply(data, .(a), summarise, totscorehomeobs=sum(y2))
&amp;gt; tot.y1.obs.neg&amp;lt;-ddply(data, .(h), summarise, totscorehomeobs=sum(y2))
&amp;gt; tot.y2.obs.neg&amp;lt;-ddply(data, .(a), summarise, totscorehomeobs=sum(y1))
&amp;gt; 
&amp;gt; #compute prediction points
&amp;gt; results&amp;lt;-list()
&amp;gt; for(i in 1:1000){
+   results[[i]]&amp;lt;-data.frame(y1.pred[i,],y2.pred[i,],ds.pred[i,],dg.pred[i,],data$h,data$a) 
+   results[[i]]$points.home&amp;lt;-ifelse(results[[i]]$ds.pred.i...==0 &amp;amp; results[[i]]$dg.pred.i...==1,3,0)
+   results[[i]]$points.home&amp;lt;-ifelse(results[[i]]$ds.pred.i...==1 &amp;amp; results[[i]]$dg.pred.i...==1,2,results[[i]]$points.home)
+   results[[i]]$points.home&amp;lt;-ifelse(results[[i]]$ds.pred.i...==1 &amp;amp; results[[i]]$dg.pred.i...==0,1,results[[i]]$points.home)
+   
+   results[[i]]$points.away&amp;lt;-ifelse(results[[i]]$ds.pred.i...==0 &amp;amp; results[[i]]$dg.pred.i...==0,3,0)
+   results[[i]]$points.away&amp;lt;-ifelse(results[[i]]$ds.pred.i...==1 &amp;amp; results[[i]]$dg.pred.i...==0,2,results[[i]]$points.away)
+   results[[i]]$points.away&amp;lt;-ifelse(results[[i]]$ds.pred.i...==1 &amp;amp; results[[i]]$dg.pred.i...==1,1,results[[i]]$points.away)
+ }
&amp;gt; 
&amp;gt; #compare results for scores by team
&amp;gt; tot.y1.list&amp;lt;-tot.y2.list&amp;lt;-list()
&amp;gt; for(i in 1:1000){
+   tot.y1.list[[i]]&amp;lt;-ddply(results[[i]], .(data.h), summarise, totscorehome=sum(y1.pred.i...))
+   tot.y2.list[[i]]&amp;lt;-ddply(results[[i]], .(data.a), summarise, totscoreaway=sum(y2.pred.i...))
+ }
&amp;gt; tot.y1.list.neg&amp;lt;-tot.y2.list.neg&amp;lt;-list()
&amp;gt; for(i in 1:1000){
+   tot.y1.list.neg[[i]]&amp;lt;-ddply(results[[i]], .(data.h), summarise, totscorehomeneg=sum(y2.pred.i...))
+   tot.y2.list.neg[[i]]&amp;lt;-ddply(results[[i]], .(data.a), summarise, totscoreawayneg=sum(y1.pred.i...))
+ }
&amp;gt; 
&amp;gt; 
&amp;gt; tot.y1.list.mat&amp;lt;-tot.y2.list.mat&amp;lt;-matrix(NA,1000,12)
&amp;gt; tot.y1.list.neg.mat&amp;lt;-tot.y2.list.neg.mat&amp;lt;-matrix(NA,1000,12)
&amp;gt; for(i in 1:1000){
+   tot.y1.list.mat[i,]&amp;lt;-tot.y1.list[[i]][,2]
+   tot.y2.list.mat[i,]&amp;lt;-tot.y2.list[[i]][,2]
+   tot.y1.list.neg.mat[i,]&amp;lt;-tot.y1.list.neg[[i]][,2]
+   tot.y2.list.neg.mat[i,]&amp;lt;-tot.y2.list.neg[[i]][,2]
+ }
&amp;gt; tot.y1.obs&amp;lt;-ddply(data, .(h), summarise, totscorehomeobs=sum(y1))
&amp;gt; tot.y2.obs&amp;lt;-ddply(data, .(a), summarise, totscorehomeobs=sum(y2))
&amp;gt; tot.y1.obs.neg&amp;lt;-ddply(data, .(h), summarise, totscorehomeobs=sum(y2))
&amp;gt; tot.y2.obs.neg&amp;lt;-ddply(data, .(a), summarise, totscorehomeobs=sum(y1))
&amp;gt; 
&amp;gt; #scored
&amp;gt; tot.y.obs&amp;lt;-tot.y1.obs[,2]+tot.y2.obs[,2]
&amp;gt; tot.y.pred&amp;lt;-apply(tot.y1.list.mat,2,median)+apply(tot.y2.list.mat,2,median)
&amp;gt; res.y&amp;lt;-cbind(tot.y.obs,tot.y.pred)
&amp;gt; rownames(res.y)&amp;lt;-names
&amp;gt; res.y&amp;lt;-round(res.y,digits = 0)
&amp;gt; 
&amp;gt; #conceded
&amp;gt; tot.y.obs.neg&amp;lt;-tot.y1.obs.neg[,2]+tot.y2.obs.neg[,2]
&amp;gt; tot.y.pred.neg&amp;lt;-apply(tot.y1.list.neg.mat,2,median)+apply(tot.y2.list.neg.mat,2,median)
&amp;gt; res.y.neg&amp;lt;-cbind(tot.y.obs.neg,tot.y.pred.neg)
&amp;gt; rownames(res.y.neg)&amp;lt;-names
&amp;gt; res.y.neg&amp;lt;-round(res.y.neg,digits = 0)
&amp;gt; 
&amp;gt; #compare results for points
&amp;gt; data.points.list&amp;lt;-list()
&amp;gt; for(i in 1:1000){
+   data.points.list[[i]]&amp;lt;-data.frame(data$Game)
+   data.points.list[[i]]$Game&amp;lt;-data$Game
+   data.points.list[[i]]$h&amp;lt;-data$h
+   data.points.list[[i]]$a&amp;lt;-data$a
+   data.points.list[[i]]$points.home&amp;lt;-results[[i]]$points.home
+   data.points.list[[i]]$points.away&amp;lt;-results[[i]]$points.away
+ }
&amp;gt; tot.home.list&amp;lt;-tot.away.list&amp;lt;-tot.team.list&amp;lt;-list()
&amp;gt; for(i in 1:1000){
+   tot.home.list[[i]]&amp;lt;-ddply(data.points.list[[i]], .(h), summarise, totpointhome=sum(points.home))
+   tot.away.list[[i]]&amp;lt;-ddply(data.points.list[[i]], .(a), summarise, totpointaway=sum(points.away))
+ }
&amp;gt; 
&amp;gt; for(i in 1:1000){
+   tot.team.list[[i]]&amp;lt;-data.frame(levels(data$home.team), tot.home.list[[i]]$h)
+   tot.team.list[[i]]$tot.team&amp;lt;-tot.home.list[[i]]$totpointhome + tot.away.list[[i]]$totpointaway
+   tot.team.list[[i]]$true.team&amp;lt;-c(19, 39, 23, 50, 19, 11, 37, 51, 32, 33, 27, 50)
+   tot.team.list[[i]]&amp;lt;-tot.team.list[[i]][order(tot.team.list[[i]]$tot.team, decreasing = TRUE),]
+   tot.team.list[[i]]$rank&amp;lt;-rep(1:12)
+ }
&amp;gt; 
&amp;gt; #plot total scores by team
&amp;gt; tot.scores&amp;lt;-matrix(NA,1000,12)
&amp;gt; colnames(tot.scores)&amp;lt;-names
&amp;gt; for(i in 1:1000){
+   for(j in 1:12){
+     tot.scores[i,j]&amp;lt;-tot.team.list[[i]]$tot.team[tot.team.list[[i]]$tot.home.list..i...h==j] 
+   }
+ }
&amp;gt; tot.scores.obs&amp;lt;-c(19, 39, 23, 50, 19, 11, 37, 51, 32, 33, 27, 50)
&amp;gt; tot.scores.med&amp;lt;-apply(tot.scores, 2, median)
&amp;gt; tot.scores.final&amp;lt;-cbind(tot.scores.obs,tot.scores.med)
&amp;gt; 
&amp;gt; #plot total wins 
&amp;gt; tot.wins&amp;lt;-matrix(NA,1000,12)
&amp;gt; colnames(tot.wins)&amp;lt;-names
&amp;gt; for(i in 1:1000){
+   for(j in 1:12){
+     tot.wins[i,j]&amp;lt;-length(data.points.list[[i]]$points.home[data.points.list[[i]]$points.home&amp;gt;1 &amp;amp; 
+                                                               data.points.list[[i]]$h==j]) + length(data.points.list[[i]]$points.away[data.points.list[[i]]$points.away&amp;gt;1 &amp;amp; 
+                                                                                                                                         data.points.list[[i]]$a==j])
+   }
+ }
&amp;gt; tot.wins.obs&amp;lt;-c(7,12,6,17,7,5,13,17,10,12,8,18)
&amp;gt; tot.wins.prop&amp;lt;-tot.wins/22
&amp;gt; tot.wins.obs.prop&amp;lt;-tot.wins.obs/22
&amp;gt; tot.wins.med&amp;lt;-apply(tot.wins, 2, median)
&amp;gt; tot.wins.final&amp;lt;-cbind(tot.wins.obs,tot.wins.med)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here, for each team, we compare the predicted and observed total number of points scored in the matches, the number of won/lost matches, and the league points scored based on a replicated and the original season results.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; #summarise pred results
&amp;gt; res.final.obs&amp;lt;-cbind(res.y[,1],res.y.neg[,1],tot.wins.final[,1],tot.scores.final[,1])
&amp;gt; res.final.pred&amp;lt;-cbind(res.y[,2],res.y.neg[,2],tot.wins.final[,2],tot.scores.final[,2])
&amp;gt; res.final&amp;lt;-cbind(res.final.obs,res.final.pred)
&amp;gt; knitr::kable(res.final, &amp;quot;pandoc&amp;quot;, align = &amp;quot;c&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Predicted results are not so bad, especially when looking at the number of league points scored by the teams between the replicated and observed season which are quite similar. These results suggest that the model seems to predict in a reasonable way the league results. To further assess this aspect, we consider two plots. The first compares the ranking of the teams across a large number of replications of the season based on the number of wins, losses and league points gained for each team.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; #summarise pred results
&amp;gt; res.matrix&amp;lt;-matrix(NA,length(tot.team.list),12)
&amp;gt; colnames(res.matrix)&amp;lt;-names
&amp;gt; for(i in 1:1000){
+   res.matrix[i,1]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==1]
+   res.matrix[i,2]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==2]
+   res.matrix[i,3]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==3]
+   res.matrix[i,4]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==4]
+   res.matrix[i,5]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==5]
+   res.matrix[i,6]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==6]
+   res.matrix[i,7]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==7]
+   res.matrix[i,8]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==8]
+   res.matrix[i,9]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==9]
+   res.matrix[i,10]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==10]
+   res.matrix[i,11]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==11]
+   res.matrix[i,12]&amp;lt;-tot.team.list[[i]]$rank[tot.team.list[[i]]$tot.home.list..i...h==12]
+ }
&amp;gt; 
&amp;gt; #create stacked barplot of results
&amp;gt; data.barplot&amp;lt;-data.frame(rep(1:c(1000*12)))
&amp;gt; names(data.barplot)&amp;lt;-c(&amp;quot;Game&amp;quot;)
&amp;gt; data.barplot$position&amp;lt;-as.factor(c(res.matrix[,1],res.matrix[,2],res.matrix[,3],res.matrix[,4],
+                                    res.matrix[,5],res.matrix[,6],res.matrix[,7],res.matrix[,8],
+                                    res.matrix[,9],res.matrix[,10],res.matrix[,11],res.matrix[,12]))
&amp;gt; data.barplot$team&amp;lt;-rep(NA,1000*12)
&amp;gt; data.barplot$team[1:1000]&amp;lt;-rep(paste(names[1]),1000)
&amp;gt; data.barplot$team[1001:2000]&amp;lt;-rep(paste(names[2]),1000)
&amp;gt; data.barplot$team[2001:3000]&amp;lt;-rep(paste(names[3]),1000)
&amp;gt; data.barplot$team[3001:4000]&amp;lt;-rep(paste(names[4]),1000)
&amp;gt; data.barplot$team[4001:5000]&amp;lt;-rep(paste(names[5]),1000)
&amp;gt; data.barplot$team[5001:6000]&amp;lt;-rep(paste(names[6]),1000)
&amp;gt; data.barplot$team[6001:7000]&amp;lt;-rep(paste(names[7]),1000)
&amp;gt; data.barplot$team[7001:8000]&amp;lt;-rep(paste(names[8]),1000)
&amp;gt; data.barplot$team[8001:9000]&amp;lt;-rep(paste(names[9]),1000)
&amp;gt; data.barplot$team[9001:10000]&amp;lt;-rep(paste(names[10]),1000)
&amp;gt; data.barplot$team[10001:11000]&amp;lt;-rep(paste(names[11]),1000)
&amp;gt; data.barplot$team[11001:12000]&amp;lt;-rep(paste(names[12]),1000)
&amp;gt; #data.barplot$team&amp;lt;-as.factor(data.barplot$team)
&amp;gt; data.barplot$team &amp;lt;-factor(data.barplot$team, levels = c(&amp;quot;Novara&amp;quot;, &amp;quot;Scandicci&amp;quot;,&amp;quot;Conegliano&amp;quot;, &amp;quot;Monza&amp;quot;,&amp;quot;Busto Arsizio&amp;quot;,
+                                                          &amp;quot;Pesaro&amp;quot;,&amp;quot;Piacenza&amp;quot;, &amp;quot;San Casciano&amp;quot;,&amp;quot;Casalmaggiore&amp;quot;, &amp;quot;Bergamo&amp;quot;,
+                                                          &amp;quot;Filottrano&amp;quot;, &amp;quot;Legnano&amp;quot;))
&amp;gt; 
&amp;gt; 
&amp;gt; 
&amp;gt; data.barplot$match&amp;lt;-c(rep(1,1000),rep(2,1000),rep(3,1000),rep(4,1000),rep(5,1000),rep(6,1000),
+                       rep(7,1000),rep(8,1000),rep(9,1000),rep(10,1000),rep(11,1000),rep(12,1000))
&amp;gt; data.barplot$match&amp;lt;-as.factor(data.barplot$match)
&amp;gt; data.barplot$Game&amp;lt;-rep(1,nrow(data.barplot))
&amp;gt; data.barplot$area&amp;lt;-ifelse(data.barplot$position==1|data.barplot$position==2|data.barplot$position==3,&amp;quot;high&amp;quot;,&amp;quot;middle&amp;quot;)
&amp;gt; data.barplot$area&amp;lt;-ifelse(data.barplot$position==12|data.barplot$position==11|data.barplot$position==10,&amp;quot;low&amp;quot;,data.barplot$area)
&amp;gt; data.barplot$area&amp;lt;-as.factor(data.barplot$area)
&amp;gt; data.barplot$area&amp;lt;-ordered(data.barplot$area,levels=c(&amp;quot;low&amp;quot;,&amp;quot;middle&amp;quot;,&amp;quot;high&amp;quot;))
&amp;gt; data.barplot$team&amp;lt;-factor(data.barplot$team,levels = rev(levels(data.barplot$team)))
&amp;gt; 
&amp;gt; df.summary1&amp;lt;-ddply(data.barplot,.(team,position),summarise,count=sum(Game), percent=sum(Game)/1000)
&amp;gt; df.summary2&amp;lt;-ddply(data.barplot,.(team,area),summarise,count=sum(Game), percent=sum(Game)/1000)
&amp;gt; 
&amp;gt; ggplot(df.summary1, aes(x=team, y=percent, fill=position)) +
+   geom_bar(stat=&amp;quot;identity&amp;quot;, width = 0.7, colour=&amp;quot;black&amp;quot;, lwd=0.1) +
+   geom_text(aes(label=ifelse(percent &amp;gt;= 0.1, paste0(sprintf(&amp;quot;%.0f&amp;quot;, percent*100),&amp;quot;%&amp;quot;),&amp;quot;&amp;quot;)),
+             position=position_stack(vjust=0.5), colour=&amp;quot;white&amp;quot;) +
+   coord_flip() + scale_y_continuous(labels = percent_format()) +
+   labs(y=&amp;quot;&amp;quot;, x=&amp;quot;&amp;quot;) + scale_fill_viridis(discrete = T) + 
+   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_rect(fill = &amp;quot;white&amp;quot;),
+         axis.line = element_line(colour = &amp;quot;black&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The mean rankings of the teams are in line with those observed in the actual season, while also providing uncertainty about the chance of each team to end in a particular position in the league (only percentages above &lt;span class=&#34;math inline&#34;&gt;\(10\%\)&lt;/span&gt; are shown for clarity).&lt;/p&gt;
&lt;p&gt;The second plot compares the points trend throughout the season for each team with respect to the trend predicted by the model based on the replicated results for each match in the season.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;&amp;gt; #########plot for cumlative points over simulated season
&amp;gt; points.list&amp;lt;-cum.points.list&amp;lt;-list()
&amp;gt; for(i in 1:nrow(res.matrix)){
+   points.list[[i]]&amp;lt;-matrix(NA,22,12)
+   cum.points.list[[i]]&amp;lt;-matrix(NA,22,12)
+   for(j in 1:12){
+     points.list[[i]][,j]&amp;lt;-c(data.points.list[[i]]$points.home[data.points.list[[i]]$h==j],data.points.list[[i]]$points.away[data.points.list[[i]]$a==j])
+   }
+   colnames(points.list[[i]])&amp;lt;-unique(levels(data$home.team))
+   rownames(points.list[[i]])&amp;lt;-rep(1:22)
+   cum.points.list[[i]]&amp;lt;-apply(points.list[[i]], 2, cumsum)
+ }
&amp;gt; 
&amp;gt; #########plot for cumlative points over simulated season
&amp;gt; points.list&amp;lt;-cum.points.list&amp;lt;-list()
&amp;gt; for(i in 1:nrow(res.matrix)){
+   points.list[[i]]&amp;lt;-matrix(NA,22,12)
+   cum.points.list[[i]]&amp;lt;-matrix(NA,22,12)
+   for(j in 1:12){
+     points.list[[i]][,j]&amp;lt;-c(data.points.list[[i]]$points.home[data.points.list[[i]]$h==j],data.points.list[[i]]$points.away[data.points.list[[i]]$a==j])
+   }
+   colnames(points.list[[i]])&amp;lt;-unique(levels(data$home.team))
+   rownames(points.list[[i]])&amp;lt;-rep(1:22)
+   cum.points.list[[i]]&amp;lt;-apply(points.list[[i]], 2, cumsum)
+ }
&amp;gt; 
&amp;gt; #plot cumulative points obs vs pred
&amp;gt; obs.cum.points&amp;lt;-matrix(NA,22,12)
&amp;gt; colnames(obs.cum.points)&amp;lt;-unique(levels(data$home.team))
&amp;gt; rownames(obs.cum.points)&amp;lt;-rep(1:22)
&amp;gt; obs.cum.points[1,]&amp;lt;-c(0,1,0,3,3,3,0,2,0,0,3,3)
&amp;gt; obs.cum.points[2,]&amp;lt;-c(0,3,0,3,0,0,3,3,0,3,0,3)
&amp;gt; obs.cum.points[3,]&amp;lt;-c(0,2,3,3,0,0,0,3,3,1,0,3)
&amp;gt; obs.cum.points[4,]&amp;lt;-c(0,3,0,3,0,0,3,3,1,2,0,3)
&amp;gt; obs.cum.points[5,]&amp;lt;-c(0,3,0,3,0,3,0,3,3,0,0,3)
&amp;gt; obs.cum.points[6,]&amp;lt;-c(0,3,1,3,0,0,0,3,1,3,2,2)
&amp;gt; obs.cum.points[7,]&amp;lt;-c(2,1,3,2,0,1,1,3,2,2,1,0)
&amp;gt; obs.cum.points[8,]&amp;lt;-c(0,2,1,1,0,0,3,2,3,2,1,3)
&amp;gt; obs.cum.points[9,]&amp;lt;-c(3,3,1,3,0,2,2,1,0,0,3,0)
&amp;gt; obs.cum.points[10,]&amp;lt;-c(1,2,1,2,1,2,1,1,2,2,1,2)
&amp;gt; obs.cum.points[11,]&amp;lt;-c(0,1,0,3,0,0,3,3,0,3,3,2)
&amp;gt; obs.cum.points[12,]&amp;lt;-c(3,0,0,3,0,0,3,3,3,0,0,3)
&amp;gt; obs.cum.points[13,]&amp;lt;-c(0,1,3,3,2,0,3,2,1,3,0,0)
&amp;gt; obs.cum.points[14,]&amp;lt;-c(2,3,1,3,0,0,0,3,3,0,0,3)
&amp;gt; obs.cum.points[15,]&amp;lt;-c(2,1,0,3,2,0,3,1,0,3,0,3)
&amp;gt; obs.cum.points[16,]&amp;lt;-c(0,3,0,3,0,0,0,3,3,0,3,3)
&amp;gt; obs.cum.points[17,]&amp;lt;-c(2,0,3,0,0,3,3,1,0,3,0,3)
&amp;gt; obs.cum.points[18,]&amp;lt;-c(0,0,0,3,3,1,2,3,1,2,3,0)
&amp;gt; obs.cum.points[19,]&amp;lt;-c(3,3,3,2,0,0,3,0,0,1,0,3)
&amp;gt; obs.cum.points[20,]&amp;lt;-c(0,0,2,0,3,1,0,3,3,0,3,3)
&amp;gt; obs.cum.points[21,]&amp;lt;-c(0,3,0,1,3,0,2,2,0,1,3,3)
&amp;gt; obs.cum.points[22,]&amp;lt;-c(1,1,1,0,2,0,2,3,3,2,1,2)
&amp;gt; 
&amp;gt; obs.cum.points&amp;lt;-apply(obs.cum.points, 2, cumsum)
&amp;gt; 
&amp;gt; par(mar=c(2.1, 3.1, 3.1, 3.1))
&amp;gt; par(mfrow=c(4,3), mai = c(0.4, 0.4, 0.1, 0.2))
&amp;gt; for(i in 1:12){
+   plot(rep(1:22),obs.cum.points[,i], axes = F, type = &amp;quot;n&amp;quot;, xlab = &amp;quot;games&amp;quot;, ylab = &amp;quot;points&amp;quot;,xlim = c(0,23),ylim = c(0,54))
+   axis(1,at=c(0,5,10,15,20,25),labels = c(0,5,10,15,20,25))
+   axis(2,at=c(0,10,20,30,40,50),labels = c(0,10,20,30,40,50))
+   lines(rep(1:22),obs.cum.points[,i], lty=1,lwd=1,col=&amp;quot;black&amp;quot;)
+   lines(rep(1:22), cum.points.list[[7]][,i], lty=1,lwd=1,col=&amp;quot;red&amp;quot;)
+   text(5,50,unique(levels(names))[i],pos = 1, cex = 1)
+ }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The observed trends (black lines) are pretty much matched by the trends predicted by the model (red lines) for most of the teams with few exceptions. This suggests that, although the model seems to have a good predictive ability, in some cases there are still margins of improvement. In my original paper I have improved the model using a different parameterisation where I tried to account for the dependence between the latent skill parameters using a scaled inverse Wishart distribution for the covariance matrix of the random effects. Here I do not consider this model here, which lead to some improvements compared with the basic Poisson model.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;conclusions&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;One potential limitation of the framework is that only match-specific statistics are
used for estimation and prediction purposes. Ideally, the use of set-specific statistics
could improve the predictive power of the model. However, this would introduce additional problems related to the choice of the distributions for modelling the number of points scored by the opposing teams in a set, which is subject to specific constraints. Finally, the flexibility of the proposed framework allows the extension of the model in many ways. For example, additional types of in-game statistics (e.g. number of passes), if available, could be incorporated to further improve the predictions of the model; alternative distributions could also be specified to model the total number of scores &lt;span class=&#34;math inline&#34;&gt;\(y\)&lt;/span&gt; during the season (e.g. Negative Binomial) which may result in a better fit to the data.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;references&#34; class=&#34;section level1 unnumbered&#34;&gt;
&lt;h1&gt;References&lt;/h1&gt;
&lt;div id=&#34;refs&#34; class=&#34;references&#34;&gt;
&lt;div id=&#34;ref-gabrio2020bayesian&#34;&gt;
&lt;p&gt;Gabrio, Andrea. 2020. “Bayesian Hierarchical Models for the Prediction of Volleyball Results.” &lt;em&gt;Journal of Applied Statistics&lt;/em&gt;, 1–21.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-gelman2015stan&#34;&gt;
&lt;p&gt;Gelman, Andrew, Daniel Lee, and Jiqiang Guo. 2015. “Stan: A Probabilistic Programming Language for Bayesian Inference and Optimization.” &lt;em&gt;Journal of Educational and Behavioral Statistics&lt;/em&gt; 40 (5): 530–43.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-rstanpackage&#34;&gt;
&lt;p&gt;Stan Development Team. 2018. “RStan: The R Interface to Stan.” &lt;a href=&#34;http://mc-stan.org/&#34;&gt;http://mc-stan.org/&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
